{"version":3,"sources":["webpack:///webpack/universalModuleDefinition?5ca6","webpack:///webpack/bootstrap 73eac5baa3034af71498?f60d","webpack:///./src/util/logger.js?b412","webpack:///./src/index.js?9552","webpack:///./src/util/fetch-util.js?fb03","webpack:///./src/util/validator.js?1fc9","webpack:///./src/model/action.js?2b9a","webpack:///./src/model/collection-doc.js?6de6","webpack:///./src/controller/station-finder.js?2e50","webpack:///./src/error/api-error.js?a2ec","webpack:///./src/model/access-token.js?2a02","webpack:///./src/model/rating.js?94ce","webpack:///./src/model/recommendation.js?5dbe","webpack:///./~/isomorphic-fetch/fetch-npm-browserify.js?7723","webpack:///./~/url-parse/index.js?8de2","webpack:///./src/controller/authorization.js?da86","webpack:///./src/controller/identity.js?aca5","webpack:///./src/controller/listening.js?012a","webpack:///./src/model/device-code.js?fddc","webpack:///./src/model/station.js?bdd8","webpack:///./src/model/user.js?522f","webpack:///./src/util/recommendation-creator.js?aa93","webpack:///./~/es6-error/lib/index.js?fdc2","webpack:///./~/js-logger/src/logger.js?85b8","webpack:///./~/querystringify/index.js?fabd","webpack:///./~/requires-port/index.js?2f61","webpack:///./~/url-parse/lolcation.js?35a3","webpack:///./~/whatwg-fetch/fetch.js?1c20"],"names":["Logger","useDefaults","formatter","messages","context","unshift","name","setLevel","WARN","NprOneSDK","_accessTokenChangedCallback","_authorization","_listening","_identity","_stationfinder","config","refreshExistingAccessToken","numRetries","logout","getDeviceCode","scopes","pollDeviceCode","getRecommendation","uid","channel","resumeFlowFromRecommendation","json","getUpcomingFlowRecommendations","getRecommendationsFromChannel","queueRecommendationFromChannel","getHistory","resetFlow","getUser","setUserStation","stationId","followShow","aggregationId","unfollowShow","createTemporaryUser","searchStations","query","searchStationsByLatLongCoordinates","lat","long","searchStationsByCityAndState","city","state","searchStationsByCity","searchStationsByState","getStationDetails","getServiceUrl","service","apiBaseUrl","apiVersion","_config","authProxyBaseUrl","newDeviceCodePath","pollDeviceCodePath","refreshTokenPath","tempUserPath","logoutPath","accessToken","clientId","advertisingId","advertisingTarget","value","Object","assign","token","TypeError","oldToken","callback","delay","Promise","setTimeout","r","ms","FetchUtil","nprApiFetch","url","options","debug","_requestUrlIsAuthorizationCall","headers","_getHeaders","fetch","then","response","ok","status","Boolean","_attemptAccessTokenRefresh","formatErrorResponse","err","_options","bind","Error","Headers","append","indexOf","RegExp","test","Validator","validateCollectionDoc","collectionDoc","requiredNames","_validate","validateAccessToken","accessTokenModel","validateDeviceCode","deviceCodeModel","object","_has","push","length","join","JSON","stringify","key","hasOwnProperty","call","Action","getEndActions","COMPLETED","SKIP","TIMEOUT","SRCHCOMPL","getFlowAdvancingActions","START","TAPTHRU","isValidAction","action","CollectionDoc","_raw","StationFinder","_performStationSearch","validateStation","searchResult","n","parseInt","isNaN","isFinite","reject","queryString","searchResults","stations","items","station","ApiError","statusText","statusCode","responseType","type","responseUrl","AccessToken","_expiryDate","expires_in","Date","now","ttl","validate","isExpired","toString","access_token","Rating","_hasSent","_recommendationUrl","_actionUrl","privateMemberReplacer","undefined","mediaId","rating","Recommendation","attributes","ratings","audio","recommendations","images","web","onramps","callsToAction","impressions","relateds","relatedImpressions","_ratingTemplate","_hasSentImpressions","_ratingReceivedCallback","_hydrate","links","image","impression","related","constructor","Array","getImages","getAudio","getWeb","getOnRamps","getImpressions","getCallsToAction","getRelateds","getRelatedImpressions","getRatings","getRecommendationUrl","href","getActionRecommendationUrl","original","potentialActions","concat","nprOneUrl","set","isSponsorship","isShareable","hasAction","hasEndAction","endAction","recordAction","elapsedTimeInSeconds","_elapsedTime","warn","duration","elapsed","timestamp","toISOString","forEach","link","mode","setRatingReceivedCallback","Authorization","_activeDeviceCodeModel","method","credentials","tokenModel","catch","body","Accept","encodeURIComponent","replace","_pollDeviceCodeOnce","error","interval","Identity","e","_setFollowingStatusForShow","shouldFollow","data","id","following","glueCharacter","Listening","_queuedRatings","_sentRatings","_flowRecommendations","_flowFetchActive","_flowPromise","_adsBlocked","_channelRecommendations","_advanceFlowRecommendations","resolve","_getChannelRecommendations","_channel","prerequisitePromise","_sendRatings","recommendation","_createRecommendations","isRecommendationFound","index","slice","_getFlowRecommendations","_filterIncomingRecommendations","unfilteredCount","_recommendations","filter","rec","filteredCount","_recordRating","_queuedRatingsContainsRating","_queuedRatingsContainsAction","recordRating","map","recommendMore","latestRating","pop","ratingsToSend","_rating","splice","some","qr","DeviceCode","user_code","verification_uri","Station","displayName","org_id","apps","npr_one","logo","type_id","tagline","callSignAndFrequency","band","frequency","trim","market_city","market_state","donation_url","User","isTemporary","getCohort","cohort","getOrganizations","organizations","getPrimaryOrganization","orgs","getAffiliations","affiliations","createRecommendations","item"],"mappings":"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CA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA,EAAC;;AAED;AACA,qC;;;;;;AC/EA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gBAAe;;AAEf;AACA;;AAEA;AACA;;AAEA,+CAA8C;AAC9C;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAa,iBAAiB;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,6CAA4C;AAC5C;AACA,WAAU;AACV;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qDAAoD;AACpD;AACA;AACA;AACA;AACA,wBAAuB;AACvB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;AACA;AACA,gCAA+B,eAAe;AAC9C;AACA;AACA;;AAEA;AACA,2CAA0C,0BAA0B;;AAEpE;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,oEAAmE,aAAa;AAChF;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAC;;;;;;;ACzPD;;AAEA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB,cAAa;AACb;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;AC5DA;;AAEA;AACA;AACA;AACA;AACA,YAAW,cAAc;AACzB,YAAW,OAAO;AAClB,cAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;ACrCA;;AAEA;AACA;AACA;AACA;AACA;AACA,WAAU;AACV;AACA;AACA,eAAc;AACd;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,0DAAyD;AACzD,IAAG;AACH,uCAAsC;AACtC;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;;;;;;;;AC5CA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,QAAO;;AAEP,MAAK;AACL;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;AACP,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA,QAAO;AACP;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;AACA,wDAAuD;AACvD,UAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAS;AACT;AACA,UAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAS;AACT;AACA,UAAS;AACT;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA,wCAAuC,0BAA0B;AACjE;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA,gCAA+B,0BAA0B,eAAe;AACxE;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,QAAO;;AAEP;AACA,MAAK;AACL;AACA;AACA,EAAC","file":"npr-one-sdk.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"NprOneSDK\"] = factory();\n\telse\n\t\troot[\"NprOneSDK\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 73eac5baa3034af71498\n **/","import * as Logger from 'js-logger';\n\n/* istanbul ignore next */\nLogger.useDefaults({\n    formatter(messages, context) {\n        messages.unshift('[NPROneSDK]');\n        if (context.name) {\n            messages.unshift(`[${context.name}]`);\n        }\n    },\n});\n\n/**\n * @typedef {JsLogger} Logger\n */\nexport default Logger;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/logger.js\n **/","import 'isomorphic-fetch';\nimport Action from './model/action';\nimport Logger from './util/logger';\nimport Authorization from './controller/authorization';\nimport Listening from './controller/listening';\nimport Identity from './controller/identity';\nimport StationFinder from './controller/station-finder';\nimport Recommendation from './model/recommendation';\n\nLogger.setLevel(Logger.WARN);\n\n/**\n * This SDK attempts to abstract away most of the interaction with the NPR One API.\n * In general, a consumer of this API should be primarily concerned with asking for\n * recommendations and recording user actions against those recommendations.\n */\nexport default class NprOneSDK\n{\n    /**\n     * Instantiates the NPR One SDK.\n     */\n    constructor() {\n        /** @type {null|Function} A callback that gets triggered whenever the access token has changed\n         * @private */\n        this._accessTokenChangedCallback = null;\n        /** @type {Authorization}\n         * @private */\n        this._authorization = new Authorization();\n        /** @type {Listening}\n         * @private */\n        this._listening = new Listening();\n        /** @type {Identity}\n         * @private */\n        this._identity = new Identity();\n        /** @type {StationFinder}\n         * @private */\n        this._stationfinder = new StationFinder();\n\n        // setup the default config\n        NprOneSDK.config; // eslint-disable-line\n    }\n\n    /**\n     * @typedef {Object} Config\n     * @property {string} [apiBaseUrl='https://api.npr.org'] The NPR One API hostname and protocol, typically `https://api.npr.org`; in most cases, this does not need to be manually set by clients\n     * @property {string} [apiVersion='v2'] The NPR One API version, typically `v2`; in most cases, this does not need to be manually set by clients\n     * @property {string} [authProxyBaseUrl] The full URL to your OAuth proxy, e.g. `http://one.example.com/oauth2/`\n     * @property {string} [newDeviceCodePath='/device'] The path to your proxy for starting a `device_code` grant (relative to `authProxyBaseUrl`)\n     * @property {string} [pollDeviceCodePath='/device/poll'] The path to your proxy for polling a `device_code` grant (relative to `authProxyBaseUrl`)\n     * @property {string} [refreshTokenPath='/refresh'] The path to your proxy for the `refresh_token` grant (relative to `authProxyBaseUrl`)\n     * @property {string} [tempUserPath='/temporary'] The path to your proxy for the `temporary_user` grant (relative to `authProxyBaseUrl`), not available to third-party clients\n     * @property {string} [logoutPath='/logout'] The path to your proxy for the `POST /authorization/v2/token/revoke` endpoint (relative to `authProxyBaseUrl`)\n     * @property {string} [accessToken] The access token to use if not using the auth proxy\n     * @property {string} [clientId] The NPR One API `client_id` to use, only required if using the auth proxy with the `temporary_user` grant type\n     * @property {string} [advertisingId] The custom X-Advertising-ID header to send with most requests, not typically used by third-party clients\n     * @property {string} [advertisingTarget] The custom X-Advertising-Target header to send with most requests, not typically used by third-party clients\n     */\n    /**\n     * @type {Config}\n     */\n    static get config() {\n        if (!NprOneSDK._config) {\n            NprOneSDK._config = {\n                apiBaseUrl: 'https://api.npr.org',\n                apiVersion: 'v2',\n                authProxyBaseUrl: '',\n                newDeviceCodePath: '/device',\n                pollDeviceCodePath: '/device/poll',\n                refreshTokenPath: '/refresh',\n                tempUserPath: '/temporary',\n                logoutPath: '/logout',\n                accessToken: '',\n                clientId: '',\n                advertisingId: '',\n                advertisingTarget: '',\n            };\n        }\n\n        /** @type {Config} */\n        return NprOneSDK._config;\n    }\n\n    /**\n     * Updates private `_config` member attributes but does not overwrite entire `_config` object\n     *\n     * @type {Config}\n     */\n    static set config(value) {\n        if (!NprOneSDK._config) {\n            NprOneSDK.config; // eslint-disable-line\n        }\n        Object.assign(NprOneSDK._config, value);\n    }\n\n    /** @type {string} */\n    static get accessToken() {\n        return NprOneSDK.config.accessToken;\n    }\n\n    /** @type {string} */\n    static set accessToken(token) {\n        if (typeof token !== 'string') {\n            throw new TypeError('Value for accessToken must be a string');\n        }\n\n        const oldToken = NprOneSDK.accessToken;\n        NprOneSDK.config.accessToken = token;\n\n        if (oldToken !== token && typeof NprOneSDK._accessTokenChangedCallback === 'function') {\n            NprOneSDK._accessTokenChangedCallback(token);\n        }\n    }\n\n    /**\n     * Sets a callback to be triggered whenever the SDK rotates the access token for a new one, usually when\n     * the old token expires and a `refresh_token` is used to generate a fresh token. Clients who wish to persist\n     * access tokens across sessions are urged to use this callback to be notified whenever a token change has\n     * occurred; the only other alternative is to call `get accessToken()` after every API call.\n     *\n     * @type {Function}\n     * @throws {TypeError} if the passed-in value isn't a function\n     */\n    static set onAccessTokenChanged(callback) {\n        if (typeof callback !== 'function') {\n            throw new TypeError('Value for onAccessTokenChanged must be a function');\n        }\n        NprOneSDK._accessTokenChangedCallback = callback;\n    }\n\n    /**\n     * Exposes the Action class for clients to record actions\n     *\n     * @type {Action}\n     */\n    static get Action() {\n        return Action;\n    }\n\n    /**\n     * Exposes the Logger class for clients to adjust logging if desired\n     *\n     * @type {src/util/logger.js~Logger}\n     */\n    static get Logger() {\n        return Logger;\n    }\n\n    /**\n     * Exposes the Recommendation class for clients who wish to resume the flow from a Recommendation\n     *\n     * @type {Recommendation}\n     */\n    static get Recommendation() {\n        return Recommendation;\n    }\n\n\n    /* Authorization */\n\n    /**\n     * See {@link Authorization.refreshExistingAccessToken} for description.\n     *\n     * @param {number} [numRetries=0]   The number of times this function has been tried. Will retry up to 3 times.\n     * @returns {Promise<AccessToken>}\n     * @throws {TypeError} if an OAuth proxy is not configured or no access token is set\n     */\n    static refreshExistingAccessToken(numRetries = 0) {\n        return Authorization.refreshExistingAccessToken(numRetries);\n    }\n\n    /**\n     * See {@link Authorization#logout} for description.\n     *\n     * @returns {Promise}\n     * @throws {TypeError} if an OAuth proxy is not configured or no access token is currently set\n     */\n    logout() {\n        return this._authorization.logout();\n    }\n\n    /**\n     * See {@link Authorization#getDeviceCode} for description.\n     *\n     * @param {Array<string>} [scopes=[]]   The scopes (as strings) that should be associated with the resulting access token\n     * @returns {Promise<DeviceCode>}\n     * @throws {TypeError} if an OAuth proxy is not configured\n     */\n    getDeviceCode(scopes = []) {\n        return this._authorization.getDeviceCode(scopes);\n    }\n\n    /**\n     * See {@link Authorization#pollDeviceCode} for description.\n     *\n     * @returns {Promise<AccessToken>}\n     * @throws {TypeError} if an OAuth proxy is not configured or `getDeviceCode()` was not previously called\n     */\n    pollDeviceCode() {\n        return this._authorization.pollDeviceCode();\n    }\n\n    /* Listening */\n\n    /**\n     * See {@link Listening#getRecommendation} for description.\n     *\n     * @param {string} [uid='']           Optional; a UID for a specific recommendation to play. In 99% of use cases, this is not needed.\n     * @param {string} [channel='npr']    Optional; a channel to pull the recommendation from; the main flow channel of `npr` is used as the default. In 99% of use cases, this does not need to be changed.\n     * @returns {Promise<Recommendation>}\n     */\n    getRecommendation(uid = '', channel = 'npr') {\n        return this._listening.getRecommendation(uid, channel);\n    }\n\n    /**\n     * See {@link Listening#resumeFlowFromRecommendation} for description.\n     *\n     * @param {Object} json JSON object representation of a recommendation\n     * @returns {Recommendation}\n     */\n    resumeFlowFromRecommendation(json) {\n        return this._listening.resumeFlowFromRecommendation(json);\n    }\n\n    /**\n     * See {@link Listening#getUpcomingFlowRecommendations} for description.\n     *\n     * @experimental\n     * @param {string} [channel='npr']   A channel to pull the next recommendation from\n     * @returns {Promise<Array<Recommendation>>}\n     */\n    getUpcomingFlowRecommendations(channel = 'npr') {\n        return this._listening.getUpcomingFlowRecommendations(channel);\n    }\n\n    /**\n     * See {@link Listening#getRecommendationsFromChannel} for description.\n     *\n     * @param {string} [channel='recommended']   A non-flow (i.e. non-`npr`) channel to retrieve a list of recommendations from\n     * @returns {Promise<Array<Recommendation>>}\n     */\n    getRecommendationsFromChannel(channel = 'recommended') {\n        return this._listening.getRecommendationsFromChannel(channel);\n    }\n\n    /**\n     * See {@link Listening#queueRecommendationFromChannel} for description.\n     *\n     * @param {string} channel   The channel used in the original call to `getRecommendationsFromChannel()`\n     * @param {string} uid       The unique ID of the item to queue up for the user\n     * @returns {Recommendation}\n     * @throws {TypeError} If no valid channel or UID is passed in\n     * @throws {Error} If no recommendations for this channel were previously cached, or if the UID was not found in that cached list\n     */\n    queueRecommendationFromChannel(channel, uid) {\n        return this._listening.queueRecommendationFromChannel(channel, uid);\n    }\n\n    /**\n     * See {@link Listening#getHistory} for description.\n     *\n     * @returns {Promise<Array<Recommendation>>}\n     */\n    getHistory() {\n        return this._listening.getHistory();\n    }\n\n    /**\n     * See {@link Listening#resetFlow} for description.\n     *\n     * @returns {Promise}\n     */\n    resetFlow() {\n        return this._listening.resetFlow();\n    }\n\n    /* Identity */\n\n    /**\n     * See {@link Identity#getUser} for description.\n     *\n     * @returns {Promise<User>}\n     */\n    getUser() {\n        return this._identity.getUser();\n    }\n\n    /**\n     * See {@link Identity#setUserStation} for description.\n     *\n     * @param {number|string} stationId   The station's ID, which is either an integer or a numeric string (e.g. `123` or `'123'`)\n     * @returns {Promise<User>}\n     */\n    setUserStation(stationId) {\n        return this._identity.setUserStation(stationId);\n    }\n\n    /**\n     * See {@link Identity#followShow} for description.\n     *\n     * @param {number|string} aggregationId    The aggregation (show) ID, which is either an integer or a numeric string (e.g. `123` or `'123'`)\n     * @returns {Promise<User>}\n     * @throws {TypeError} if the passed-in aggregation (show) ID is not either a number or a numeric string\n     */\n    followShow(aggregationId) {\n        return this._identity.followShow(aggregationId);\n    }\n\n    /**\n     * See {@link Identity#unfollowShow} for description.\n     *\n     * @param {number|string} aggregationId    The aggregation (show) ID, which is either an integer or a numeric string (e.g. `123` or `'123'`)\n     * @returns {Promise<User>}\n     * @throws {TypeError} if the passed-in aggregation (show) ID is not either a number or a numeric string\n     */\n    unfollowShow(aggregationId) {\n        return this._identity.unfollowShow(aggregationId);\n    }\n\n    /**\n     * See {@link Identity#createTemporaryUser} for description.\n     *\n     * @returns {Promise<User>}\n     * @throws {TypeError} if an OAuth proxy is not configured or no client ID is set\n     */\n    createTemporaryUser() {\n        return this._identity.createTemporaryUser();\n    }\n\n    /* Station Finder */\n\n    /**\n     * See {@link StationFinder#searchStations} for description.\n     *\n     * @param {null|string} [query]   An optional query, which can be a station name, network name, or zip code\n     * @returns {Promise<Array<Station>>}\n     */\n    searchStations(query = null) {\n        return this._stationfinder.searchStations(query);\n    }\n\n    /**\n     * See {@link StationFinder#searchStationsByLatLongCoordinates} for description.\n     *\n     * @param {number} lat    A float representing the latitude value of the geographic coordinates\n     * @param {number} long   A float representing the longitude value of the geographic coordinates\n     * @returns {Promise<Array<Station>>}\n     */\n    searchStationsByLatLongCoordinates(lat, long) {\n        return this._stationfinder.searchStationsByLatLongCoordinates(lat, long);\n    }\n\n    /**\n     * See {@link StationFinder#searchStationsByCityAndState} for description.\n     *\n     * @param {string} city     A full city name (e.g. \"New York\", \"San Francisco\", \"Phoenix\")\n     * @param {string} state    A state name (e.g. \"Maryland\") or abbreviation (e.g. \"MD\")\n     * @returns {Promise<Array<Station>>}\n     */\n    searchStationsByCityAndState(city, state) {\n        return this._stationfinder.searchStationsByCityAndState(city, state);\n    }\n\n    /**\n     * See {@link StationFinder#searchStationsByCity} for description.\n     *\n     * @param {string} city   A full city name (e.g. \"New York\", \"San Francisco\", \"Phoenix\")\n     * @returns {Promise<Array<Station>>}\n     */\n    searchStationsByCity(city) {\n        return this._stationfinder.searchStationsByCity(city);\n    }\n\n    /**\n     * See {@link StationFinder#searchStationsByState} for description.\n     *\n     * @param {string} state    A state name (e.g. \"Maryland\") or abbreviation (e.g. \"MD\")\n     * @returns {Promise<Array<Station>>}\n     */\n    searchStationsByState(state) {\n        return this._stationfinder.searchStationsByState(state);\n    }\n\n    /**\n     * See {@link StationFinder#getStationDetails} for description.\n     *\n     * @param {number|string} stationId   The station's ID, which is either an integer or a numeric string (e.g. `123` or `'123'`)\n     * @returns {Promise<Station>}\n     */\n    getStationDetails(stationId) {\n        return this._stationfinder.getStationDetails(stationId);\n    }\n\n    /**\n     * Returns the foundational path for a given service\n     *\n     * @param {string} service\n     * @returns {string}\n     */\n    static getServiceUrl(service) {\n        return `${NprOneSDK.config.apiBaseUrl}/${service}/${NprOneSDK.config.apiVersion}`;\n    }\n}\n\n/**\n * @external {Response} https://developer.mozilla.org/en-US/docs/Web/API/Response\n */\n/**\n * @external {Headers} https://developer.mozilla.org/en-US/docs/Web/API/Headers\n */\n/**\n * @external {JsLogger} https://github.com/jonnyreeves/js-logger\n */\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","import Logger from './logger';\nimport NPROneSDK from './../index';\nimport ApiError from './../error/api-error';\n\n\n/**\n * Simulates a delay by wrapping a Promise around JavaScript's native `setTimeout` function.\n *\n * @param {number} ms The amount of time to delay for, in milliseconds\n * @returns {Promise}\n * @private\n */\nconst delay = ms => new Promise(r => setTimeout(r, ms));\n\n\n/**\n * A thin wrapper around the Fetch API which provides functionality to automatically\n * request a new access token if an existing one has expired.\n */\nexport default class FetchUtil\n{\n    /**\n     * Primary workhorse for interacting with the NPR One APIs.\n     *\n     * @param {string} url\n     * @param {Object} [options]\n     * @returns {Promise<Object>}\n     */\n    static nprApiFetch(url, options = {}) {\n        Logger.debug(`Starting JSON fetch ${url}`);\n\n        if (!FetchUtil._requestUrlIsAuthorizationCall(url) && !options.headers) {\n            options.headers = FetchUtil._getHeaders(); // eslint-disable-line\n        }\n\n        return fetch(url, options)\n            .then((response) => {\n                if (response.ok) {\n                    return response.json();\n                } else if (response.status === 401 && Boolean(NPROneSDK.accessToken)\n                    && !FetchUtil._requestUrlIsAuthorizationCall(url)) {\n                    return FetchUtil._attemptAccessTokenRefresh(url, options);\n                }\n                return FetchUtil.formatErrorResponse(response);\n            });\n    }\n\n    /**\n     * Wraps an error response from an API call in an {@link ApiError} object so that consuming code has more\n     * flexibility to determine how to handle the error. To be clear: this function returns a Promise that **always**\n     * rejects, but it may or may not have the deserialized JSON body based on whether `response.json()` succeeded or\n     * failed (the latter is usually an indicator that the response had an empty body).\n     *\n     * @param {Response} response\n     * @returns {Promise}\n     */\n    static formatErrorResponse(response) {\n        return response.json()\n            .then((json) => {\n                throw new ApiError(response, json);\n            }, (err) => { // this will ONLY catch errors from the deserialization, and not from the line above this\n                Logger.debug('Problem deserializing JSON from API error');\n                Logger.debug(err);\n                throw new ApiError(response);\n            });\n    }\n\n    /**\n     * The logic to attempt an access token refresh, broken out for easier readability.\n     *\n     * @param {string} url\n     * @param {Object} options\n     * @returns {Promise<Object>}\n     * @private\n     */\n    static _attemptAccessTokenRefresh(url, options) {\n        return NPROneSDK.refreshExistingAccessToken()\n            .then(() => { // retry the original request we were making, after a short delay\n                const _options = options;\n                /* istanbul ignore else */ // defensive coding\n                if (options.headers) {\n                    _options.headers = FetchUtil._getHeaders(); // make sure we use the new access token\n                }\n\n                return delay(250)\n                    .then(FetchUtil.nprApiFetch.bind(this, url, _options));\n            });\n    }\n\n    /**\n     * Ensures access token is defined and generates the required Headers object for fetch\n     *\n     * @returns {Headers}\n     * @private\n     */\n    static _getHeaders() {\n        if (NPROneSDK.accessToken === '') {\n            throw new Error('An Access Token must set before making API requests.');\n        }\n\n        const headers = new Headers();\n        headers.append('Authorization', `Bearer ${NPROneSDK.accessToken}`);\n        if (NPROneSDK.config.advertisingId) {\n            headers.append('X-Advertising-ID', `${NPROneSDK.config.advertisingId}`);\n        }\n        if (NPROneSDK.config.advertisingTarget) {\n            headers.append('X-Advertising-Target', `${NPROneSDK.config.advertisingTarget}`);\n        }\n        return headers;\n    }\n\n    /**\n     * Tests whether or not the call to the given URL should be considered an authorization call.\n     *\n     * @param {string} url\n     * @returns {boolean}\n     * @private\n     */\n    static _requestUrlIsAuthorizationCall(url) {\n        return (NPROneSDK.config.authProxyBaseUrl && (url.indexOf(NPROneSDK.config.authProxyBaseUrl) > -1))\n            || new RegExp(`/authorization/${NPROneSDK.config.apiVersion}`).test(url);\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/fetch-util.js\n **/","/**\n * A utility class which performs validations by checking of required object properties exist.\n */\nexport default class Validator {\n    /**\n     * Validates collection doc format\n     *\n     * @param {Object} collectionDoc\n     * @throws {TypeError} if collection doc is invalid\n     */\n    static validateCollectionDoc(collectionDoc) {\n        const requiredNames = [\n            'version', 'href', 'attributes', 'items', 'links', 'errors',\n        ];\n\n        Validator._validate(collectionDoc, requiredNames);\n    }\n\n    /**\n     * Validates an access token model (obtained from the `POST /authorization/v2/token` endpoint)\n     *\n     * @param {Object} accessTokenModel\n     * @throws {TypeError} if access token model is invalid\n     */\n    static validateAccessToken(accessTokenModel) {\n        const requiredNames = [\n            'access_token', 'token_type', 'expires_in',\n        ];\n\n        Validator._validate(accessTokenModel, requiredNames);\n    }\n\n    /**\n     * Validates a device code model (obtained from the `POST /authorization/v2/device` endpoint)\n     *\n     * @param {Object} deviceCodeModel\n     * @throws {TypeError} if device code model is invalid\n     */\n    static validateDeviceCode(deviceCodeModel) {\n        const requiredNames = [\n            'user_code', 'verification_uri', 'expires_in', 'interval',\n        ];\n\n        Validator._validate(deviceCodeModel, requiredNames);\n    }\n\n    /**\n     * Base validator function.\n     *\n     * @param {Object} object\n     * @param {Array<string>} requiredNames\n     * @throws {TypeError} if object is invalid\n     * @private\n     */\n    static _validate(object, requiredNames) {\n        const messages = [];\n\n        for (const name of requiredNames) {\n            if (!Validator._has(object, name)) {\n                messages.push(`'${name}' is missing and is required.`);\n            }\n        }\n\n        if (messages.length > 0) {\n            throw new TypeError(`${messages.join(', ')} :${JSON.stringify(object)}`);\n        }\n    }\n\n    /**\n     * A typesafe check to make sure the property exists within the object.\n     *\n     * @param {Object} object\n     * @param {string} key\n     * @returns {boolean}\n     * @private\n     */\n    static _has(object, key) {\n        /* istanbul ignore next: defensive coding, not going to worry too much about this */\n        return object ? {}.hasOwnProperty.call(object, key) : false;\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/validator.js\n **/","/**\n * Actions that can be recorded for recommendations.\n * For more detail on user rating actions, see our narrative [Listening Service documentation](http://dev.npr.org/guide/services/listening/#Ratings)\n */\nexport default class Action\n{\n    /** @type {string} */\n    static get COMPLETED() {\n        return 'COMPLETED';\n    }\n\n    /** @type {string} */\n    static get PASS() {\n        return 'PASS';\n    }\n\n    /** @type {string} */\n    static get SHARE() {\n        return 'SHARE';\n    }\n\n    /** @type {string} */\n    static get SKIP() {\n        return 'SKIP';\n    }\n\n    /** @type {string} */\n    static get SRCHCOMPL() {\n        return 'SRCHCOMPL';\n    }\n\n    /** @type {string} */\n    static get SRCHSTART() {\n        return 'SRCHSTART';\n    }\n\n    /** @type {string} */\n    static get START() {\n        return 'START';\n    }\n\n    /** @type {string} */\n    static get THUMBUP() {\n        return 'THUMBUP';\n    }\n\n    /** @type {string} */\n    static get TIMEOUT() {\n        return 'TIMEOUT';\n    }\n\n    /** @type {string} */\n    static get TAPTHRU() {\n        return 'TAPTHRU';\n    }\n\n    /**\n     * Actions which indicate the recommendation is no longer being presented to the user\n     *\n     * @returns {Array<string>}\n     */\n    static getEndActions() {\n        return [\n            Action.COMPLETED, Action.SKIP, Action.TIMEOUT, Action.SRCHCOMPL,\n        ];\n    }\n\n    /**\n     * Actions which should result in the flow advancing\n     *\n     * @returns {Array<string>}\n     */\n    static getFlowAdvancingActions() {\n        return [\n            Action.START, Action.TAPTHRU, Action.TIMEOUT,\n        ];\n    }\n\n    /**\n     * Returns whether a given action is valid or not\n     *\n     * @param {string} action\n     * @returns {boolean}\n     */\n    static isValidAction(action) {\n        return {}.hasOwnProperty.call(Action, action);\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/model/action.js\n **/","import Validator from './../util/validator';\n\n/**\n * A base model for any resources following our Collection Doc schema\n * @see http://cdoc.io\n */\nexport default class CollectionDoc\n{\n    /**\n     * @param {CollectionDocJSON} json     The decoded JSON object that should be used as the basis for this model\n     */\n    constructor(json) {\n        /** @type {Object}\n         * @protected */\n        this._raw = json;\n    }\n\n    /**\n     * Ensure that the given Collection Doc is valid\n     *\n     * @throws {TypeError} if collection doc is invalid\n     * @protected\n     */\n    _validate() {\n        Validator.validateCollectionDoc(this._raw);\n    }\n\n    /**\n     * Exposed for legacy reasons. Prefer model accessor methods were possible.\n     *\n     * @type {CollectionDocJSON}\n     */\n    get collectionDoc() {\n        return this._raw;\n    }\n\n    /**\n     * @typedef {Object} CollectionDocJSON\n     * @property {string} version The version of the Collection.Doc+JSON Hypermedia Type Specification being used by this document\n     * @property {string} href A unique identifier of the resource representation in the form of a Uniform Resource Identifier (URI)\n     * @property {Object} attributes A set of metadata attributes that represent the \"state\" of the resource in the form of key-value pairs; may be an empty object\n     * @property {Array} items A list of items associated with this document; may be an empty array\n     * @property {Object} links A map of resources that expose controls and communicate relationships with other documents; the keys describe the relationship to the current document, while the values are arrays of links\n     * @property {Array} errors A list of errors encountered in the process of creating and/or retrieving this document, intended to facilitate reliable debugging of client/server interactions\n     */\n    /**\n     * @typedef {Object} Link\n     * @property {string} [content-type] The MIME-type of the resource\n     * @property {string} href The URI that represents the resource\n     */\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/model/collection-doc.js\n **/","import NPROneSDK from './../index';\nimport FetchUtil from './../util/fetch-util';\nimport Station from './../model/station';\n\n\n/**\n * Encapsulates all of the logic for communication with the [Station Finder Service](http://dev.npr.org/api/#/stationfinder)\n * in the NPR One API.\n *\n * Note that consumers should not be accessing this class directly but should instead use the provided pass-through\n * functions in the main {@link NprOneSDK} class.\n *\n * @example <caption>How to change a user's station using station search</caption>\n * const nprOneSDK = new NprOneSDK();\n * nprOneSDK.config = { ... };\n * nprOneSDK.getUser() // optional; verifies that you have a logged-in user\n *     .then(() => {\n *         return nprOneSDK.searchStations('wnyc');\n *     })\n *     .then((stations) => {\n *         const stationId = stations[0].id; // in reality, you'd probably have the user select a station from returned search results\n *         nprOneSDK.setUserStation(stationId);\n *     });\n */\nexport default class StationFinder {\n    /**\n     * Performs a general search of all NPR One stations, using an optional query. If passed in, the query can be any\n     * string, such as an address or keyword, but the recommended usage is to search for station names, network names\n     * (e.g. \"Colorado Public Radio\" is a network of stations throughout Colorado), or zip codes.\n     *\n     * If no query is passed in, this function will return a list of one or more stations geographically closest to the\n     * client based on the consumer's IP address. If you are running this in a server-side environment where the IP\n     * address of the server is not necessarily the same as the IP address (and, by extension, the geographic location)\n     * of the end-user, you can use {@link searchStationsByLatLongCoordinates} instead to retrieve a list of stations\n     * geographically closest to the end-user.\n     *\n     * @param {null|string} [query]   An optional query, which can be a station name, network name, or zip code\n     * @returns {Promise<Array<Station>>}\n     */\n    searchStations(query = null) {\n        return this._performStationSearch(query);\n    }\n\n    /**\n     * Performs a geographic search of all NPR One stations using a passed-in pair of lat-long coordinates. In most\n     * cases, this means you will need to first use the [HTML5 Geolocation API](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/Using_geolocation)\n     * or a similar library in order to obtain the lat-long coordinates for the end-user's location.\n     *\n     * Note that {@link searchStations} without a query will already produce a list of stations closest to the user _if_\n     * this code is being run in a client-side environment and/or the IP address of the device making the calls to this\n     * SDK has the same geographic location as the end-user. For that reason, `searchStationsByLatLongCoordinates()`\n     * is really only needed if this SDK is being run in a server-side environment.\n     *\n     * @param {number} lat    A float representing the latitude value of the geographic coordinates\n     * @param {number} long   A float representing the longitude value of the geographic coordinates\n     * @returns {Promise<Array<Station>>}\n     */\n    searchStationsByLatLongCoordinates(lat, long) {\n        return this._performStationSearch(null, lat, long);\n    }\n\n    /**\n     * Performs a geographic search of all NPR One stations using a city name and state. While you _can_ pass in a city\n     * _or_ state to {@link searchStations} as the query, `searchStationsByCityAndState()` will return more accurate\n     * results and is the recommended function for clients wanting to offer a location search.\n     *\n     * @param {string} city     A full city name (e.g. \"New York\", \"San Francisco\", \"Phoenix\")\n     * @param {string} state    A state name (e.g. \"Maryland\") or abbreviation (e.g. \"MD\")\n     * @returns {Promise<Array<Station>>}\n     */\n    searchStationsByCityAndState(city, state) {\n        return this._performStationSearch(null, null, null, city, state);\n    }\n\n    /**\n     * Performs a geographic search of all NPR One stations using a city name only. It is generally recommended that you\n     * use {@link searchStationsByCityAndState} instead, as it will return more accurate results and is the recommended\n     * function for clients wanting to offer a location search.\n     *\n     * @param {string} city   A full city name (e.g. \"New York\", \"San Francisco\", \"Phoenix\")\n     * @returns {Promise<Array<Station>>}\n     */\n    searchStationsByCity(city) {\n        return this._performStationSearch(null, null, null, city);\n    }\n\n    /**\n     * Performs a geographic search of all NPR One stations using a state name or abbreviation only. It is generally\n     * recommended that you use {@link searchStationsByCityAndState} instead, as it will return more accurate results\n     * and is the recommended function for clients wanting to offer a location search.\n     *\n     * @param {string} state    A state name (e.g. \"Maryland\") or abbreviation (e.g. \"MD\")\n     * @returns {Promise<Array<Station>>}\n     */\n    searchStationsByState(state) {\n        return this._performStationSearch(null, null, null, null, state);\n    }\n\n    /**\n     * Returns a {@link Station} model for the station with the given ID.\n     *\n     * @param {number|string} stationId   The station's ID, which is either an integer or a numeric string (e.g. `123` or `'123'`)\n     * @returns {Promise<Station>}\n     */\n    getStationDetails(stationId) {\n        return StationFinder.validateStation(stationId)\n            .then(searchResult => new Station(searchResult));\n    }\n\n    /**\n     * Ensures a station ID is associated with a valid NPR station. While this technically returns the raw JSON for\n     * this station if it exists, these results are not meant to be consumed directly; if you need the station details to display to your end-user,\n     * use {@link getStationDetails} instead, which calls this function under-the-hood and returns the results parsed\n     * into a {@link Station} model.\n     *\n     * @param {number|string} stationId   The station's ID, which is either an integer or a numeric string (e.g. `123` or `'123'`)\n     * @returns {Promise}\n     */\n    static validateStation(stationId) {\n        const n = parseInt(stationId, 10);\n        if (isNaN(n) || !isFinite(n)) {\n            return Promise.reject(new Error('Station ID must be an integer greater than 0'));\n        }\n\n        const url = `${NPROneSDK.getServiceUrl('stationfinder')}/organizations/${stationId}`;\n\n        return FetchUtil.nprApiFetch(url);\n    }\n\n    /**\n     * A private helper function that performs the actual station search.\n     *\n     * @param {null|string} query     An optional query, which can be a station name, network name, or zip code\n     * @param {null|number} [lat]     A float representing the latitude value of the geographic coordinates\n     * @param {null|number} [long]    A float representing the longitude value of the geographic coordinates\n     * @param {null|string} [city]    A full city name (e.g. \"New York\", \"San Francisco\", \"Phoenix\")\n     * @param {null|string} [state]   A state name (e.g. \"Maryland\") or abbreviation (e.g. \"MD\")\n     * @returns {Promise<Array<Station>>}\n     * @private\n     */\n    _performStationSearch(query, lat = null, long = null, city = null, state = null) {\n        const url = `${NPROneSDK.getServiceUrl('stationfinder')}/organizations`;\n\n        let queryString = '';\n        if (query) {\n            if (typeof query !== 'string') {\n                throw new TypeError('Station search query must be a string');\n            }\n            queryString = `q=${query}`;\n        } else if (lat || long) {\n            if (typeof lat !== 'number' || typeof long !== 'number') {\n                throw new TypeError('Latitude and longitude must both be valid numbers (floats)');\n            }\n            queryString = `lat=${lat}&long=${long}`;\n        } else {\n            if (city) {\n                if (typeof city !== 'string') {\n                    throw new TypeError('Station search city name must be a string');\n                }\n                queryString += `city=${city}`;\n            }\n            if (state) {\n                if (typeof state !== 'string') {\n                    throw new TypeError('Station search state name must be a string');\n                }\n                queryString += `state=${state}`;\n            }\n        }\n\n        return FetchUtil.nprApiFetch(queryString ? `${url}?${queryString}` : url)\n            .then((searchResults) => {\n                const stations = [];\n\n                if (searchResults && searchResults.items && searchResults.items.length) {\n                    for (const searchResult of searchResults.items) {\n                        const station = new Station(searchResult);\n                        stations.push(station);\n                    }\n                }\n\n                return stations;\n            });\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/controller/station-finder.js\n **/","import ExtendableError from 'es6-error';\n\n\n/**\n * A custom error class to encapsulate errors thrown by {@link FetchUtil.nprApiFetch}. Behaves like a generic JavaScript\n * error, but has additional metadata attached to it in case consuming code needs to be able to respond to specific\n * kinds of errors.\n *\n * @example\n * nprOneSDK.setUserStation(123)\n *     .catch((error) => {\n *         if (error instanceof ApiError) {\n *             if (error.statusCode === 401) {\n *                 Logger.debug('The response was a 401!');\n *             } else {\n *                 Logger.debug('The response was not a 401!');\n *             }\n *         }\n *     });\n *\n * @extends {Error}\n */\nexport default class ApiError extends ExtendableError {\n    /**\n     * Creates a new, custom error using the [Fetch Response](https://developer.mozilla.org/en-US/docs/Web/API/Response)\n     * object as its basis.\n     *\n     * @param {Response} response    The actual raw [Fetch Response](https://developer.mozilla.org/en-US/docs/Web/API/Response) from the failed API call\n     * @param {Object} [json={}]     If available, the decoded JSON from the error response\n     */\n    constructor(response, json = {}) {\n        super(`Response status: ${response.status} ${response.statusText}`);\n\n        /**\n         * The status code of the response (e.g., `400` for a bad request).\n         *\n         * @type {number}\n         */\n        this.statusCode = response.status;\n        /**\n         * The status message corresponding to the status code (e.g., `Bad Request` for 400).\n         *\n         * @type {string}\n         */\n        this.statusText = response.statusText;\n        /**\n         * The headers associated with the response.\n         *\n         * @type {Headers}\n         */\n        this.headers = response.headers;\n        /**\n         * Contains the type of the response (e.g., basic, cors).\n         *\n         * @type {string}\n         */\n        this.responseType = response.type;\n        /**\n         * Contains the URL of the response.\n         *\n         * @type {string}\n         */\n        this.responseUrl = response.url;\n        /**\n         * Contains the decoded JSON of the response, if any.\n         *\n         * @type {Object}\n         */\n        this.json = json;\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/error/api-error.js\n **/","import Validator from './../util/validator';\n\n/**\n * A thin wrapper around the raw JSON returned from the authorization server to represent an access token\n */\nexport default class AccessToken\n{\n    /**\n     * @param {Object} json    The decoded JSON object that should be used as the basis for this model\n     */\n    constructor(json) {\n        this._raw = json;\n\n        this._expiryDate = null;\n        if (!isNaN(this._raw.expires_in)) {\n            this._expiryDate = new Date(Date.now() + this.ttl);\n        }\n    }\n\n    /**\n     * Ensure that the given access token model is valid\n     *\n     * @throws {TypeError} if access token model is invalid\n     */\n    validate() {\n        Validator.validateAccessToken(this._raw);\n    }\n\n    /**\n     * Returns whether or not this access token has expired.\n     * Note that due to network latency, etc., it's possible that the internally-stored expiry date could be about a\n     * second or so behind, and so this function is not guaranteed to be perfectly accurate.\n     *\n     * @returns {boolean}\n     */\n    isExpired() {\n        return this._expiryDate !== null && (new Date()) >= this._expiryDate;\n    }\n\n    /**\n     * Returns the access token itself (40-character alphanumeric string)\n     *\n     * @type {string}\n     */\n    get token() {\n        return this._raw.access_token;\n    }\n\n    /**\n     * Returns the TTL (in milliseconds) until this access token expires. If you are using an auth proxy and have\n     * correctly configured the `refreshTokenUrl`, this SDK will automatically refresh expired access tokens for you,\n     * so consumers typically do not need to worry about whether or not a token is expired or about to expire.\n     *\n     * @type {number}\n     */\n    get ttl() {\n        return this._raw.expires_in * 1000;\n    }\n\n    /**\n     * A convenience function to cast this object back to a string, generally only used by the {@link Logger} class.\n     * In this case, we return only the `access_token` itself, since the rest of the object is typically not useful.\n     *\n     * @returns {string}\n     */\n    toString() {\n        return this._raw.access_token;\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/model/access-token.js\n **/","/**\n * Container class for all metadata pertaining to an action that a user has taken against a recommendation.\n */\nexport default class Rating\n{\n    /**\n     * @param {Object} json The decoded JSON object that should be used as the basis for this model\n     * @param {string} json.mediaId The media id as given by the media object\n     * @param {string} json.origin How the recommendation was generated\n     * @param {string} json.rating String representing the rating (action)\n     * @param {number} json.elapsed Number of seconds since the start of playback for this media item, as an integer\n     * @param {number} json.duration Number of seconds this audio piece is expected to last\n     * @param {string} json.timestamp ISO-8601 formatted date/time; typically replaced by the client with the actual rating time\n     * @param {string} json.channel The channel this media item was pulled from\n     * @param {string} json.cohort The primary cohort of the current logged-in user\n     * @param {Array} json.affiliations An array of IDs & other data about collections or podcasts the user has ratings for; produced by the server and should be sent back as received; used for tracking program and podcast suggestions\n     */\n    constructor(json) {\n        Object.assign(this, json);\n        this._hasSent = false;\n        this._recommendationUrl = '';\n        this._actionUrl = '';\n    }\n\n    /**\n     * Only send the fields back that NPR has sent us\n     *\n     * @param {string} key\n     * @param {boolean|string|number|Array|Object|Function} value\n     * @returns {undefined|boolean|string|number|Array|Object|Function}\n     */\n    static privateMemberReplacer(key, value) {\n        if (['_hasSent', '_recommendationUrl', '_actionUrl'].indexOf(key) >= 0) {\n            return undefined;\n        }\n        return value;\n    }\n\n    /**\n     * A convenience function to cast this object back to a string, generally only used by the {@link Logger} class.\n     *\n     * @returns {string}\n     */\n    toString() {\n        return `[RID=${this.mediaId}, R=${this.rating}]`;\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/model/rating.js\n **/","import 'isomorphic-fetch';\nimport URL from 'url-parse';\nimport CollectionDoc from './collection-doc';\nimport Rating from './rating';\nimport Action from './action';\nimport Logger from './../util/logger';\n\n\n/**\n * Container class for all metadata pertaining to a recommendation.\n *\n * Provides metadata and the recordAction method, which sends feedback on user actions to NPR's APIs and advances the flow of audio recommendations to the user\n *\n * @extends {CollectionDoc}\n */\nexport default class Recommendation extends CollectionDoc\n{\n    /**\n     * @param {CollectionDocJSON} json   The decoded JSON object that should be used as the basis for this model\n     */\n    constructor(json) {\n        super(json);\n        /** @type {Object}\n         * @private */\n        this._raw = json;\n        /**\n         * The metadata used to describe this recommendation, such as type and title\n         * @type {RecommendationAttributes}\n         */\n        this.attributes = {};\n        /**\n         * An internal store of ratings collected for this application; should never be accessed directly by consumers\n         * @type {Array<Rating>}\n         */\n        this.ratings = [];\n        /**\n         * The actual audio files associated with this recommendation; should never be empty\n         * @type {Array<Link>}\n         */\n        this.audio = [];\n        /**\n         * A list of API calls the app can make to retrieve subsequent recommendations; should never be accessed directly by consumers\n         * @type {Array<Link>}\n         */\n        this.recommendations = [];\n        /**\n         * A list of images associated with this recommendation; could be empty\n         * @type {Array<ImageLink>}\n         */\n        this.images = [];\n        /**\n         * A list of links to other places where this story can be found on the web (for example, on NPR.org); could be empty\n         * @type {Array<Link>}\n         */\n        this.web = [];\n        /**\n         * A list of links that are used as the canonical link(s) when sharing this story on social media\n         * @type {Array<Link>}\n         */\n        this.onramps = [];\n        /**\n         * This is the `action` array from the API within `links`, and _NOT_ this SDK's notion of {@link Action}\n         * @type {Array<Link>}\n         */\n        this.callsToAction = [];\n        /**\n         * A list of API calls to make if this recommendation is of type `sponsorship` and the consuming client\n         * has played the accompanying audio\n         * @type {Array<FormFactorLink>}\n         */\n        this.impressions = [];\n        /**\n         * A list of links to places where the app can take the user if they interact with this `sponsorship` item\n         * @type {Array<FormFactorLink>}\n         */\n        this.relateds = [];\n        /**\n         * A list of API calls to make if this recommendation is of type `sponsorship` and the consuming client has\n         * chosen to interact with the sponsorship item using the contents of {@link relateds}\n         * @type {Array<FormFactorLink>}\n         */\n        this.relatedImpressions = [];\n        /** @type {Object}\n          * @private */\n        this._ratingTemplate = {};\n        /**\n         * Used to prevent impressions from being fired twice\n         * @type {boolean}\n         * @private\n         */\n        this._hasSentImpressions = false;\n        /** @type {null|Function}\n          * @private */\n        this._ratingReceivedCallback = null;\n\n        this._hydrate();\n    }\n\n    /**\n     * Hydrate the internal member variables.\n     *\n     * @private\n     */\n    _hydrate() {\n        this._validate();\n\n        this._ratingTemplate = this._raw.attributes.rating;\n\n        // deep copy, we do not want duplicate rating objects\n        this.attributes = Object.assign({}, this._raw.attributes);\n        delete this.attributes.rating;\n\n        const links = this._raw.links;\n\n        // Required\n        this.audio = links.audio;\n        this.recommendations = links.recommendations;\n\n        // Optional\n        this.web = links.web ? links.web : [];\n        this.images = links.image ? links.image : [];\n        this.onramps = links.onramps ? links.onramps : [];\n        this.callsToAction = links.action ? links.action : [];\n        this.impressions = links.impression ? links.impression : [];\n        this.relateds = links.related ? links.related : [];\n        this.relatedImpressions = links['related-impression'] ? links['related-impression'] : [];\n    }\n\n    /**\n     * Determines whether the collection doc has the required fields for a valid recommendation\n     *\n     * @protected\n     * @throws {TypeError} if the collection doc is invalid\n     */\n    _validate() {\n        const links = this._raw.links;\n\n        if (!links.audio ||\n            links.audio.constructor !== Array ||\n            links.audio.length <= 0) {\n            throw new TypeError('Audio must exist within links.');\n        }\n\n        if (!links.recommendations ||\n            links.recommendations.constructor !== Array ||\n            links.recommendations.length <= 0) {\n            throw new TypeError('Recommendation (contains URL) must exist within links.');\n        }\n\n        if (!this._raw.attributes.rating) {\n            throw new TypeError('Attributes must contain a rating object.');\n        }\n    }\n\n    /**\n     * Returns a list of images associated with this recommendation\n     *\n     * @returns {Array<ImageLink>}\n     */\n    getImages() {\n        return this.images;\n    }\n\n    /**\n     * Returns the actual audio files associated with this recommendation\n     *\n     * @returns {Array<Link>}\n     */\n    getAudio() {\n        return this.audio;\n    }\n\n    /**\n     * Returns a list of links to other places where this story can be found on the web (for example, on NPR.org)\n     *\n     * @returns {Array<Link>}\n     */\n    getWeb() {\n        return this.web;\n    }\n\n    /**\n     * Returns a list of links that are used as the canonical link(s) when sharing this story on social media.\n     *\n     * @returns {Array<Link>}\n     */\n    getOnRamps() {\n        return this.onramps;\n    }\n\n    /**\n     * Returns a list of API calls to make if this recommendation is of type `sponsorship` and the consuming client\n     * has played the accompanying audio. Note that the SDK will take care of this automatically as long as the client\n     * uses {@link recordAction} to send the rating.\n     *\n     * @returns {Array<FormFactorLink>}\n     */\n    getImpressions() {\n        return this.impressions;\n    }\n\n    /**\n     * This is the `action` array from the API within `links`, and _NOT_ this SDK's notion of {@link Action}\n     *\n     * An example of what might be contained within this is array is a link to full-length content\n     * for a promo recommendation.\n     *\n     * @returns {Array<Link>}\n     */\n    getCallsToAction() {\n        return this.callsToAction;\n    }\n\n    /**\n     * Returns a list of links to places where the app can take the user if they interact with this `sponsorship` item\n     * (such as by clicking/tapping on the image or using a voice command to learn more)\n     *\n     * @returns {Array<FormFactorLink>}\n     */\n    getRelateds() {\n        return this.relateds;\n    }\n\n    /**\n     * Returns a list of API calls to make if this recommendation is of type `sponsorship` and the consuming client\n     * has chosen to interact with the sponsorship item using the contents returned by {@link getRelateds}. Note that\n     * the SDK will take care of this automatically as long as the client uses {@link recordAction} to send the rating.\n     *\n     * @returns {Array<FormFactorLink>}\n     */\n    getRelatedImpressions() {\n        return this.relatedImpressions;\n    }\n\n    /**\n     * Returns an internal store of ratings collected for this application. This should never be accessed directly by\n     * consumers; use {@link recordAction} to send ratings, and the SDK will figure out the appropriate time to make\n     * the API call that submits them to the server.\n     *\n     * @returns {Array<Rating>}\n     */\n    getRatings() {\n        return this.ratings;\n    }\n\n    /**\n     * Returns the URL that should be used to obtain the next set of recommendations. This should typically not be used\n     * by clients directly; use {@link recordAction} followed by {@link NprOneSDK#getRecommendation} instead.\n     *\n     * @returns {string}\n     */\n    getRecommendationUrl() {\n        return this.recommendations[0].href;\n    }\n\n    /**\n     * This method looks through the recommendation's action and related array to search for any URL starting with `'nprone://listen'`.\n     * If found, everything from the query params is appended to the original recommendation URL.\n     * This value is then used anytime a user indicates they want more similar stories by clicking or tapping on this recommendation.\n     *\n     * For many recommendations, this will not exist and getRecommendationUrl is used instead.\n     *\n     * @returns {string}\n     */\n    getActionRecommendationUrl() {\n        const original = new URL(this.getRecommendationUrl());\n        const potentialActions = this.callsToAction.concat(this.relateds);\n\n        let nprOneUrl = '';\n        for (const action of potentialActions) {\n            if (action.href && action.href.indexOf('nprone://') === 0) {\n                nprOneUrl = new URL(action.href);\n                break;\n            }\n        }\n\n        let url = '';\n        if (nprOneUrl) {\n            url = `${original.set('query', nprOneUrl.query).href}&recommend=true`;\n        }\n\n        return url;\n    }\n\n    /**\n     * Returns whether this recommendation is of type `sponsorship`\n     *\n     * @returns {boolean}\n     */\n    isSponsorship() {\n        return this.attributes.type === 'sponsorship';\n    }\n\n    /**\n     * Returns whether this recommendation is shareable on social media\n     *\n     * @returns {boolean}\n     */\n    isShareable() {\n        return this.onramps.length > 0;\n    }\n\n    /**\n     * Returns whether this recommendation has a given action\n     *\n     * @param {string} action    Which action to look up; should be one of the static string constants returned by {@link Action}\n     * @returns {boolean}\n     */\n    hasAction(action) {\n        for (const rating of this.ratings) {\n            if (rating.rating === action) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * Returns whether this recommendation has received a rating indicating it is no longer\n     * being presented to the user\n     *\n     * @returns {boolean}\n     */\n    hasEndAction() {\n        for (const endAction of Action.getEndActions()) {\n            if (this.hasAction(endAction)) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * Record a user action taken and the time it was taken against this recommendation\n     *\n     * @param {string} action                  Which action to record; should be one of the static string constants returned by {@link Action}\n     * @param {number} elapsedTimeInSeconds    The number of seconds this piece of audio has been playing for\n     */\n    recordAction(action, elapsedTimeInSeconds) {\n        let _elapsedTime = elapsedTimeInSeconds;\n\n        if (!Action.isValidAction(action)) {\n            throw new Error(`${action} action is invalid. See Action class for valid actions.`);\n        }\n\n        const n = parseInt(_elapsedTime, 10);\n        if (isNaN(n) || !isFinite(n)) {\n            throw new Error('Elapsed time must be supplied and be a positive integer value.');\n        }\n\n        if (_elapsedTime < 0) {\n            Logger.warn(`Elapsed time of ${_elapsedTime} is invalid ` +\n                'and has been changed to 0 seconds.');\n            _elapsedTime = 0;\n        }\n\n        if (_elapsedTime > this.attributes.duration && this.attributes.duration > 0) {\n            // 30s has been arbitrarily chosen as it's enough to indicate the consumer of this SDK might have made a coding error.\n            if (_elapsedTime > this.attributes.duration + 30) {\n                Logger.warn(`Elapsed time of ${_elapsedTime} exceeds overall audio duration ` +\n                    `and has been modified to ${this.attributes.duration} seconds.`);\n            }\n            _elapsedTime = this.attributes.duration;\n        }\n\n        if (_elapsedTime === 0 && (action === Action.COMPLETED || action === Action.SKIP)) {\n            Logger.warn('Elapsed time value should be greater than zero; ' +\n                'please ensure the time passed since the START rating is recorded.');\n        }\n\n        if (action !== Action.START) {\n            if (!this.hasAction(Action.START)) {\n                Logger.warn(`Action '${action}' has been recorded; however, no START action ` +\n                    'exists. Please ensure START actions are recorded first.');\n            }\n        }\n\n        const rating = new Rating(this._ratingTemplate);\n        rating.rating = action;\n        rating.elapsed = _elapsedTime;\n        rating.timestamp = new Date().toISOString();\n        rating._recommendationUrl = this.getRecommendationUrl();\n        rating._actionUrl = this.getActionRecommendationUrl();\n\n        // Handle Sponsorship Impressions\n        if (this.isSponsorship() && action === Action.START && !this._hasSentImpressions) {\n            this._hasSentImpressions = true;\n            const impressions = this.impressions.concat(this.relatedImpressions);\n            impressions.forEach((link) => {\n                if (link['form-factor'] === 'audio') {\n                    fetch(link.href, { mode: 'no-cors' });  // no really, that's it. We don't care about the result of these fetches.\n                }\n            });\n        }\n\n        this.ratings.push(rating);\n\n        if (this._ratingReceivedCallback !== null) {\n            this._ratingReceivedCallback(rating);\n        }\n    }\n\n    /**\n     * A callback which provides for communication of a received rating\n     *\n     * @param {?Function} callback    A function to call whenever this recommendation has received a rating (action)\n     */\n    setRatingReceivedCallback(callback) {\n        this._ratingReceivedCallback = callback;\n    }\n\n    /**\n     * A convenience function to cast this object back to a string, generally only used by the {@link Logger} class.\n     *\n     * @returns {string}\n     */\n    toString() {\n        return `[UID=${this.attributes.uid}, R=${this.getRatings().join(',')}]`;\n    }\n\n    /**\n     * @typedef {Object} RecommendationAttributes\n     * @property {string} type The type of recommendation, usually `audio`. Can also be `stationId`, `sponsorship`, etc.\n     * @property {string} uid The universal identifier of the recommendation\n     * @property {string} title The title of the recommendation\n     * @property {boolean} skippable Whether or not the recommendation is skippable, usually true, but false for e.g. sponsorship\n     * @property {string} [slug] A slug or category for the recommendation\n     * @property {string} provider The provider of the story, usually `NPR`. Can also be a member station or third-party podcast provider.\n     * @property {string} [program] The program as part of which this recommendation aired\n     * @property {number} duration The duration of the audio according to the API; note that the actual duration can differ\n     * @property {string} date ISO-8601 formatted date/time; the date at which the story was first published\n     * @property {string} [description] A short description of the recommendation\n     * @property {string} rationale The reason for recommending this piece to the listener\n     * @property {string} [button] The text to display in a clickable button on a feature card\n     */\n    /**\n     * @typedef {Link} FormFactorLink\n     * @property {string} [form-factor] The form-factor for the most appropriate display of or interaction with the resource, usually irrelevant unless there is more than one link of the same type\n     */\n    /**\n     * @typedef {FormFactorLink} ImageLink\n     * @property {string} [rel] The relation of the image to the content, which usually corresponds to the crop-type\n     * @property {number} [height] The pixel height of the image\n     * @property {number} [width] The pixel width of the image\n     */\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/model/recommendation.js\n **/","// the whatwg-fetch polyfill installs the fetch() function\n// on the global object (window or self)\n//\n// Return that as the export for use in Webpack, Browserify etc.\nrequire('whatwg-fetch');\nmodule.exports = self.fetch.bind(self);\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/isomorphic-fetch/fetch-npm-browserify.js\n ** module id = 12\n ** module chunks = 0 1\n **/","'use strict';\n\nvar required = require('requires-port')\n  , lolcation = require('./lolcation')\n  , qs = require('querystringify')\n  , relativere = /^\\/(?!\\/)/;\n\n/**\n * These are the parse instructions for the URL parsers, it informs the parser\n * about:\n *\n * 0. The char it Needs to parse, if it's a string it should be done using\n *    indexOf, RegExp using exec and NaN means set as current value.\n * 1. The property we should set when parsing this value.\n * 2. Indication if it's backwards or forward parsing, when set as number it's\n *    the value of extra chars that should be split off.\n * 3. Inherit from location if non existing in the parser.\n * 4. `toLowerCase` the resulting value.\n */\nvar instructions = [\n  ['#', 'hash'],                        // Extract from the back.\n  ['?', 'query'],                       // Extract from the back.\n  ['//', 'protocol', 2, 1, 1],          // Extract from the front.\n  ['/', 'pathname'],                    // Extract from the back.\n  ['@', 'auth', 1],                     // Extract from the front.\n  [NaN, 'host', undefined, 1, 1],       // Set left over value.\n  [/\\:(\\d+)$/, 'port'],                 // RegExp the back.\n  [NaN, 'hostname', undefined, 1, 1]    // Set left over.\n];\n\n/**\n * The actual URL instance. Instead of returning an object we've opted-in to\n * create an actual constructor as it's much more memory efficient and\n * faster and it pleases my CDO.\n *\n * @constructor\n * @param {String} address URL we want to parse.\n * @param {Boolean|function} parser Parser for the query string.\n * @param {Object} location Location defaults for relative paths.\n * @api public\n */\nfunction URL(address, location, parser) {\n  if (!(this instanceof URL)) {\n    return new URL(address, location, parser);\n  }\n\n  var relative = relativere.test(address)\n    , parse, instruction, index, key\n    , type = typeof location\n    , url = this\n    , i = 0;\n\n  //\n  // The following if statements allows this module two have compatibility with\n  // 2 different API:\n  //\n  // 1. Node.js's `url.parse` api which accepts a URL, boolean as arguments\n  //    where the boolean indicates that the query string should also be parsed.\n  //\n  // 2. The `URL` interface of the browser which accepts a URL, object as\n  //    arguments. The supplied object will be used as default values / fall-back\n  //    for relative paths.\n  //\n  if ('object' !== type && 'string' !== type) {\n    parser = location;\n    location = null;\n  }\n\n  if (parser && 'function' !== typeof parser) {\n    parser = qs.parse;\n  }\n\n  location = lolcation(location);\n\n  for (; i < instructions.length; i++) {\n    instruction = instructions[i];\n    parse = instruction[0];\n    key = instruction[1];\n\n    if (parse !== parse) {\n      url[key] = address;\n    } else if ('string' === typeof parse) {\n      if (~(index = address.indexOf(parse))) {\n        if ('number' === typeof instruction[2]) {\n          url[key] = address.slice(0, index);\n          address = address.slice(index + instruction[2]);\n        } else {\n          url[key] = address.slice(index);\n          address = address.slice(0, index);\n        }\n      }\n    } else if (index = parse.exec(address)) {\n      url[key] = index[1];\n      address = address.slice(0, address.length - index[0].length);\n    }\n\n    url[key] = url[key] || (instruction[3] || ('port' === key && relative) ? location[key] || '' : '');\n\n    //\n    // Hostname, host and protocol should be lowercased so they can be used to\n    // create a proper `origin`.\n    //\n    if (instruction[4]) {\n      url[key] = url[key].toLowerCase();\n    }\n  }\n\n  //\n  // Also parse the supplied query string in to an object. If we're supplied\n  // with a custom parser as function use that instead of the default build-in\n  // parser.\n  //\n  if (parser) url.query = parser(url.query);\n\n  //\n  // We should not add port numbers if they are already the default port number\n  // for a given protocol. As the host also contains the port number we're going\n  // override it with the hostname which contains no port number.\n  //\n  if (!required(url.port, url.protocol)) {\n    url.host = url.hostname;\n    url.port = '';\n  }\n\n  //\n  // Parse down the `auth` for the username and password.\n  //\n  url.username = url.password = '';\n  if (url.auth) {\n    instruction = url.auth.split(':');\n    url.username = instruction[0] || '';\n    url.password = instruction[1] || '';\n  }\n\n  //\n  // The href is just the compiled result.\n  //\n  url.href = url.toString();\n}\n\n/**\n * This is convenience method for changing properties in the URL instance to\n * insure that they all propagate correctly.\n *\n * @param {String} prop Property we need to adjust.\n * @param {Mixed} value The newly assigned value.\n * @returns {URL}\n * @api public\n */\nURL.prototype.set = function set(part, value, fn) {\n  var url = this;\n\n  if ('query' === part) {\n    if ('string' === typeof value && value.length) {\n      value = (fn || qs.parse)(value);\n    }\n\n    url[part] = value;\n  } else if ('port' === part) {\n    url[part] = value;\n\n    if (!required(value, url.protocol)) {\n      url.host = url.hostname;\n      url[part] = '';\n    } else if (value) {\n      url.host = url.hostname +':'+ value;\n    }\n  } else if ('hostname' === part) {\n    url[part] = value;\n\n    if (url.port) value += ':'+ url.port;\n    url.host = value;\n  } else if ('host' === part) {\n    url[part] = value;\n\n    if (/\\:\\d+/.test(value)) {\n      value = value.split(':');\n      url.hostname = value[0];\n      url.port = value[1];\n    }\n  } else {\n    url[part] = value;\n  }\n\n  url.href = url.toString();\n  return url;\n};\n\n/**\n * Transform the properties back in to a valid and full URL string.\n *\n * @param {Function} stringify Optional query stringify function.\n * @returns {String}\n * @api public\n */\nURL.prototype.toString = function toString(stringify) {\n  if (!stringify || 'function' !== typeof stringify) stringify = qs.stringify;\n\n  var query\n    , url = this\n    , result = url.protocol +'//';\n\n  if (url.username) {\n    result += url.username;\n    if (url.password) result += ':'+ url.password;\n    result += '@';\n  }\n\n  result += url.hostname;\n  if (url.port) result += ':'+ url.port;\n\n  result += url.pathname;\n\n  query = 'object' === typeof url.query ? stringify(url.query) : url.query;\n  if (query) result += '?' !== query.charAt(0) ? '?'+ query : query;\n\n  if (url.hash) result += url.hash;\n\n  return result;\n};\n\n//\n// Expose the URL parser and some additional properties that might be useful for\n// others.\n//\nURL.qs = qs;\nURL.location = lolcation;\nmodule.exports = URL;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/url-parse/index.js\n ** module id = 13\n ** module chunks = 0 1\n **/","import NPROneSDK from './../index';\nimport AccessToken from './../model/access-token';\nimport DeviceCode from './../model/device-code';\nimport Logger from './../util/logger';\nimport FetchUtil from './../util/fetch-util';\nimport ApiError from './../error/api-error';\n\n\n/**\n * Simulates a delay by wrapping a Promise around JavaScript's native `setTimeout` function.\n *\n * @param {number} ms The amount of time to delay for, in milliseconds\n * @returns {Promise}\n * @private\n */\nconst delay = ms => new Promise(r => setTimeout(r, ms));\n\n\n/**\n * Encapsulates all of the logic for communication with the [Authorization Service](http://dev.npr.org/api/#/authorization)\n * in the NPR One API.\n *\n * Note that consumers should not be accessing this class directly but should instead use the provided pass-through\n * functions in the main {@link NprOneSDK} class.\n *\n * @example <caption>Rudimentary example of implementing the Device Code flow</caption>\n * const nprOneSDK = new NprOneSDK();\n * nprOneSDK.config = { ... };\n * const scopes = ['identity.readonly', 'identity.write', 'listening.readonly', 'listening.write'];\n * nprOneSDK.getDeviceCode(scopes)\n *     .then((deviceCodeModel) => {\n *         // display code to user on the screen\n *         nprOneSDK.pollDeviceCode()\n *             .then(() => {\n *                 nprOneSDK.getRecommendation();\n *             });\n *      })\n *     .catch(() => {\n *         nprOneSDK.getDeviceCode(scopes).then(...); // repeat ad infinitum until `pollDeviceCode()` resolves successfully\n *         // In actual use, it may be preferable to refactor this into a recursive function\n *     ));\n */\nexport default class Authorization {\n    /**\n     * Initializes the controller class with private variables needed later on.\n     */\n    constructor() {\n        /** @type {null|DeviceCode} The device code model for the currently-active device code grant\n         * @private */\n        this._activeDeviceCodeModel = null;\n    }\n\n    /**\n     * Attempts to swap the existing access token for a new one using the refresh token endpoint in the OAuth proxy\n     *\n     * @param {number} [numRetries=0]   The number of times this function has been tried. Will retry up to 3 times.\n     * @returns {Promise<AccessToken>}\n     * @throws {TypeError} if an OAuth proxy is not configured or no access token is set\n     */\n    static refreshExistingAccessToken(numRetries = 0) {\n        if (!NPROneSDK.config.authProxyBaseUrl) {\n            throw new TypeError('OAuth proxy not configured. Unable to refresh the access token.');\n        }\n        if (!NPROneSDK.accessToken) {\n            throw new TypeError('An access token must be set in order to attempt a refresh.');\n        }\n\n        Logger.debug('Access token appears to have expired. Attempting to generate a fresh one.');\n\n        const url = `${NPROneSDK.config.authProxyBaseUrl}${NPROneSDK.config.refreshTokenPath}`;\n        const options = {\n            method: 'POST',\n            credentials: 'include',\n        };\n\n        return FetchUtil.nprApiFetch(url, options)\n            .then((json) => {\n                const tokenModel = new AccessToken(json);\n                tokenModel.validate(); // throws exception if invalid\n                Logger.debug('Access token refresh was successful, new token:',\n                    tokenModel.toString());\n                NPROneSDK.accessToken = tokenModel.token;\n                return tokenModel; // never directly consumed, but useful for testing\n            })\n            .catch((err) => {\n                Logger.debug('Error generating a new token in refreshExistingAccessToken()');\n                Logger.debug(err);\n\n                if (numRetries < 2) {\n                    Logger.debug('refreshExistingAccessToken() will make another attempt');\n                    return delay(5000)\n                        .then(Authorization.refreshExistingAccessToken.bind(this, numRetries + 1));\n                }\n\n                // rethrow\n                Logger.debug('refreshExistingAccessToken() has made too many attempts, aborting');\n                return Promise.reject(err);\n            });\n    }\n\n    /**\n     * Logs out the user, revoking their access token from the authorization server and removing the refresh token from\n     * the secure storage in the backend proxy (if a backend proxy is configured). Note that the consuming client is\n     * still responsible for removing the access token anywhere else it might be stored outside of this SDK (e.g. in\n     * localStorage or elsewhere in application memory).\n     *\n     * @returns {Promise}\n     * @throws {TypeError} if an OAuth proxy is not configured or no access token is currently set\n     */\n    logout() {\n        if (!NPROneSDK.accessToken) {\n            throw new TypeError('An access token must be set in order to attempt a logout.');\n        }\n        if (!NPROneSDK.config.authProxyBaseUrl) {\n            throw new TypeError('OAuth proxy not configured. Unable to securely log out the user.');\n        }\n\n        const url = `${NPROneSDK.config.authProxyBaseUrl}${NPROneSDK.config.logoutPath}`;\n        const options = {\n            method: 'POST',\n            credentials: 'include',\n            body: `token=${NPROneSDK.accessToken}`,\n            headers: {\n                Accept: 'application/json, application/xml, text/plain, text/html, *.*',\n                'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8',\n            },\n        };\n\n        return fetch(url, options) // we cannot use FetchUtil.nprApiFetch() here because the success response has an empty body\n            .then((response) => {\n                if (response.ok) {\n                    NPROneSDK.accessToken = '';\n                    return true;\n                }\n                return FetchUtil.formatErrorResponse(response);\n            });\n    }\n\n    /**\n     * Uses the OAuth proxy to start a `device_code` grant flow. This function _just_ makes an API call that produces a\n     * device code/user code pair, and should be followed up with a call to {@link pollDeviceCode} in order to complete\n     * the process.\n     *\n     * Note that device code/user code pairs do expire after a set time, so the consuming client may need to call these\n     * 2 functions multiple times before the user logs in. It is a good idea to encapsulate them in a function which\n     * can be called recursively on errors; see the example below for details.\n     *\n     * @example\n     * function logInViaDeviceCode(scopes) {\n     *     nprOneSDK.getDeviceCode(scopes)\n     *         .then((deviceCodeModel) => {\n     *             displayCodeToUser(deviceCodeModel); // display code to user on the screen\n     *             nprOneSDK.pollDeviceCode()\n     *                 .then(() => {\n     *                     startPlayingAudio(); // you're now ready to call `nprOneSDK.getRecommendation()` elsewhere in your app\n     *                 }).catch(logInViaDeviceCode.bind(this, scopes)); // recursively call this function until the user logs in\n     *         });\n     * }\n     *\n     * @see http://dev.npr.org/guide/services/authorization/#device_code\n     *\n     * @param {Array<string>} [scopes=[]]   The scopes (as strings) that should be associated with the resulting access token\n     * @returns {Promise<DeviceCode>}\n     * @throws {TypeError} if an OAuth proxy is not configured\n     */\n    getDeviceCode(scopes = []) {\n        if (!NPROneSDK.config.authProxyBaseUrl) {\n            throw new TypeError('OAuth proxy not configured. Unable to use the device code.');\n        }\n\n        const url = `${NPROneSDK.config.authProxyBaseUrl}${NPROneSDK.config.newDeviceCodePath}`;\n        const options = {\n            method: 'POST',\n            credentials: 'include',\n            body: `scope=${encodeURIComponent(scopes.join(' ')).replace('%20', '+')}`,\n            headers: {\n                Accept: 'application/json, application/xml, text/plain, text/html, *.*',\n                'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8',\n            },\n        };\n\n        return FetchUtil.nprApiFetch(url, options)\n            .then((json) => {\n                const deviceCodeModel = new DeviceCode(json);\n                deviceCodeModel.validate(); // throws exception if invalid\n                this._activeDeviceCodeModel = deviceCodeModel;\n                return deviceCodeModel;\n            });\n    }\n\n    /**\n     * Uses the OAuth proxy to poll the access token endpoint as part of a `device_code` grant flow. This endpoint will\n     * continue to poll until the user successfully logs in, _or_ the user goes to log in but then denies the request\n     * for access to their account by this client, _or_ the device code/user code pair expires, whichever comes first.\n     * In the first case, it will automatically set {@link NPROneSDK.accessToken} to the newly-generated access token,\n     * and the consuming client can proceed to play recommendations immediately; in the other 2 cases, it will return\n     * a Promise that rejects with a debugging message, but the next course of action would generally be to call\n     * {@link getDeviceCode} again and start the whole process from the top.\n     *\n     * @example\n     * function logInViaDeviceCode(scopes) {\n     *     nprOneSDK.getDeviceCode(scopes)\n     *         .then((deviceCodeModel) => {\n     *             displayCodeToUser(deviceCodeModel); // display code to user on the screen\n     *             nprOneSDK.pollDeviceCode()\n     *                 .then(() => {\n     *                     startPlayingAudio(); // you're now ready to call `nprOneSDK.getRecommendation()` elsewhere in your app\n     *                 }).catch(logInViaDeviceCode.bind(this, scopes)); // recursively call this function until the user logs in\n     *         });\n     * }\n     *\n     * @see http://dev.npr.org/guide/services/authorization/#device_code\n     *\n     * @returns {Promise<AccessToken>}\n     * @throws {TypeError} if an OAuth proxy is not configured or `getDeviceCode()` was not previously called\n     */\n    pollDeviceCode() {\n        Logger.debug('Starting to poll device code. Will poll until user logs in or code expires'); // eslint-disable-line max-len\n\n        if (!NPROneSDK.config.authProxyBaseUrl) {\n            throw new TypeError('OAuth proxy not configured. Unable to use the device code.');\n        }\n        if (!this._activeDeviceCodeModel) {\n            throw new TypeError('No active device code set. Please call getDeviceCode() before calling this function.'); // eslint-disable-line max-len\n        }\n\n        return this._pollDeviceCodeOnce();\n    }\n\n    /**\n     * Polls the device code once. If the result is an error of type `'authorization_pending'`, this will recurse,\n     * calling itself after a delay equal to the interval specified in the original call to {@link getDeviceCode}.\n     *\n     * @returns {Promise<AccessToken>}\n     * @private\n     */\n    _pollDeviceCodeOnce() {\n        Logger.debug('Polling device code once');\n\n        if (this._activeDeviceCodeModel.isExpired()) {\n            return Promise.reject('The device code has expired. Please generate a new one before continuing.'); // eslint-disable-line max-len\n        }\n\n        const url = `${NPROneSDK.config.authProxyBaseUrl}${NPROneSDK.config.pollDeviceCodePath}`;\n        const options = {\n            method: 'POST',\n            credentials: 'include',\n        };\n\n        return FetchUtil.nprApiFetch(url, options)\n            .then((json) => {\n                Logger.debug('Device code poll returned successfully! An access token was returned.'); // eslint-disable-line max-len\n\n                const tokenModel = new AccessToken(json);\n                tokenModel.validate(); // throws exception if invalid\n                NPROneSDK.accessToken = tokenModel.token;\n                return tokenModel; // never directly consumed, but useful for testing\n            })\n            .catch((error) => {\n                if (error instanceof ApiError) {\n                    if (error.statusCode === 401) {\n                        if (error.json.type === 'authorization_pending') {\n                            return delay(this._activeDeviceCodeModel.interval)\n                                .then(this._pollDeviceCodeOnce.bind(this));\n                        }\n                        Logger.debug('The response was a 401, but not of type \"authorization_pending\". The user presumably denied the app access; rejecting.'); // eslint-disable-line max-len\n                    } else {\n                        Logger.debug('Response was not a 401. The device code has probably expired; rejecting.'); // eslint-disable-line max-len\n                    }\n                } else {\n                    Logger.debug('An unknown type of error was received. Unsure of how to respond; rejecting.'); // eslint-disable-line max-len\n                }\n                return Promise.reject(error);\n            });\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/controller/authorization.js\n **/","import NPROneSDK from './../index';\nimport FetchUtil from './../util/fetch-util';\nimport User from './../model/user';\nimport Logger from './../util/logger';\nimport AccessToken from './../model/access-token';\nimport StationFinder from './station-finder';\n\n\n/**\n * Encapsulates all of the logic for communication with the [Identity Service](http://dev.npr.org/api/#/identity)\n * in the NPR One API.\n *\n * Note that consumers should not be accessing this class directly but should instead use the provided pass-through\n * functions in the main {@link NprOneSDK} class.\n *\n * @example <caption>How to change a user's station using station search</caption>\n * const nprOneSDK = new NprOneSDK();\n * nprOneSDK.config = { ... };\n * nprOneSDK.getUser() // optional; verifies that you have a logged-in user\n *     .then(() => {\n *        return nprOneSDK.searchStations('wnyc');\n *     })\n *     .then((stations) => {\n *         const stationId = stations[0].id; // in reality, you'd probably have the user select a station, see the StationFinder for detail\n *         nprOneSDK.setUserStation(stationId);\n *     });\n */\nexport default class Identity {\n    /**\n     * Gets user metadata, such as first and last name, programs they have shown an affinity for, and preferred NPR One\n     * station.\n     *\n     * @returns {Promise<User>}\n     */\n    getUser() {\n        const url = `${NPROneSDK.getServiceUrl('identity')}/user`;\n\n        return FetchUtil.nprApiFetch(url).then(json => new User(json));\n    }\n\n    /**\n     * Sets a user's favorite NPR station. Note that this function will first validate whether the station with the given\n     * ID actually exists, and will return a promise that rejects if not.\n     *\n     * @param {number|string} stationId   The station's ID, which is either an integer or a numeric string (e.g. `123` or `'123'`)\n     * @returns {Promise<User>}\n     */\n    setUserStation(stationId) {\n        return StationFinder.validateStation(stationId)\n            .then(() => {\n                const url = `${NPROneSDK.getServiceUrl('identity')}/stations`;\n                const options = {\n                    method: 'PUT',\n                    body: JSON.stringify([stationId]),\n                };\n                return FetchUtil.nprApiFetch(url, options).then(json => new User(json));\n            })\n            .catch((e) => {\n                Logger.debug('setUserStation failed, message: ', e);\n                return Promise.reject(e);\n            });\n    }\n\n    /**\n     * Indicates that the user wishes to follow, or subscribe to, the show, program, or podcast with the given numeric\n     * ID. Followed shows will appear more frequently in a user's list of recommendations.\n     *\n     * Note that at this time, because we have not yet implemented search in this SDK, there is no way to retrieve a list\n     * of aggregation (show) IDs through this SDK. You can either add functionality to your own app that makes an API call\n     * to `GET https://api.npr.org/listening/v2/search/recommendations` with a program name or other search parameters, or\n     * wait until we implement search in this SDK (hopefully later this year).\n     *\n     * @param {number|string} aggregationId    The aggregation (show) ID, which is either an integer or a numeric string (e.g. `123` or `'123'`)\n     * @returns {Promise<User>}\n     * @throws {TypeError} if the passed-in aggregation (show) ID is not either a number or a numeric string\n     */\n    followShow(aggregationId) {\n        return this._setFollowingStatusForShow(aggregationId, true);\n    }\n\n    /**\n     * Indicates that the user wishes to unfollow, or unsubscribe from, the show, program, or podcast with the given\n     * numeric ID. See {@link followShow} for more information.\n     *\n     * @param {number|string} aggregationId    The aggregation (show) ID, which is either an integer or a numeric string (e.g. `123` or `'123'`)\n     * @returns {Promise<User>}\n     * @throws {TypeError} if the passed-in aggregation (show) ID is not either a number or a numeric string\n     */\n    unfollowShow(aggregationId) {\n        return this._setFollowingStatusForShow(aggregationId, false);\n    }\n\n    /**\n     * Primary workhorse for {@link followShow} and {@link unfollowShow}.\n     *\n     * @param {number|string} aggregationId    The aggregation (show) ID, which is either an integer or a numeric string (e.g. `123` or `'123'`)\n     * @param {boolean} shouldFollow           Whether or not the aggregation should be followed (`true`) or unfollowed (`false`)\n     * @returns {Promise<User>}\n     * @throws {TypeError} if the passed-in aggregation (show) ID is not either a number or a numeric string\n     * @private\n     */\n    _setFollowingStatusForShow(aggregationId, shouldFollow) {\n        const n = parseInt(aggregationId, 10);\n        if (isNaN(n) || !isFinite(n)) {\n            throw new TypeError('Aggregation (show) ID must be an integer greater than 0');\n        }\n\n        const data = {\n            id: aggregationId,\n            following: shouldFollow,\n        };\n\n        const url = `${NPROneSDK.getServiceUrl('identity')}/following`;\n        const options = {\n            method: 'POST',\n            body: JSON.stringify(data),\n        };\n\n        return FetchUtil.nprApiFetch(url, options).then(json => new User(json));\n    }\n\n    /**\n     * Creates a temporary user from the NPR One API and use that user's access token for\n     * subsequent API requests.\n     *\n     * Caution: most clients are not authorized to use temporary users.\n     *\n     * @returns {Promise<User>}\n     * @throws {TypeError} if an OAuth proxy is not configured or no client ID is set\n     */\n    createTemporaryUser() {\n        if (!NPROneSDK.config.authProxyBaseUrl) {\n            throw new TypeError('OAuth proxy not configured. Unable to create temporary users.');\n        }\n        if (!NPROneSDK.config.clientId) {\n            throw new TypeError('A client ID must be set for temporary user requests.');\n        }\n\n        let url = `${NPROneSDK.config.authProxyBaseUrl}${NPROneSDK.config.tempUserPath}`;\n        const glueCharacter = url.indexOf('?') >= 0 ? '&' : '?';\n        url = `${url}${glueCharacter}clientId=${NPROneSDK.config.clientId}`;\n\n        const options = {\n            credentials: 'include',\n        };\n\n        return FetchUtil.nprApiFetch(url, options)\n            .then((json) => {\n                const tokenModel = new AccessToken(json);\n                tokenModel.validate(); // throws exception if invalid\n                NPROneSDK.accessToken = tokenModel.token;\n                return tokenModel; // never directly consumed, but useful for testing\n            });\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/controller/identity.js\n **/","import NPROneSDK from './../index';\nimport createRecommendations from './../util/recommendation-creator';\nimport Action from './../model/action';\nimport Rating from './../model/rating';\nimport Logger from './../util/logger';\nimport FetchUtil from './../util/fetch-util';\n\n\n/**\n * Encapsulates all of the logic for communication with the [Listening Service](http://dev.npr.org/api/#/listening)\n * in the NPR One API.\n *\n * Note that consumers should not be accessing this class directly but should instead use the provided pass-through\n * functions in the main {@link NprOneSDK} class.\n *\n * @example <caption>Implementing a rudimentary 'Explore' view</caption>\n * const nprOneSDK = new NprOneSDK();\n * nprOneSDK.config = { ... };\n * nprOneSDK.getRecommendationsFromChannel('recommended')\n *     .then((recommendations) => {\n *         // in a real app, the user would select a piece; here we've simulated them selecting one at index 3\n *         const selectedRecommendationId = recommendations[3].attributes.uid;\n *         return nprOneSDK.queueRecommendationFromChannel('recommended', selectedRecommendationId);\n *      })\n *     .then(() => {\n *         nprOneSDK.getRecommendation(); // proceed to play the recommendation\n *     });\n */\nexport default class Listening {\n    /**\n     * Initializes the controller class with private variables needed later on.\n     */\n    constructor() {\n        /** @type {Rating[]} Ratings which are queued to be sent to NPR\n         * @private */\n        this._queuedRatings = [];\n        /** @type {Rating[]} Ratings which have already been sent, for debugging purposes\n         * @private */\n        this._sentRatings = [];\n        /** @type {Array<Recommendation>} Unrated recommendations which represent the latest\n         *  recommendations from the API, relies heavily upon numeric key/index\n         * @private */\n        this._flowRecommendations = [];\n        /** @type {boolean} Flow fetches need to be synchronous\n         * @private */\n        this._flowFetchActive = false;\n        /** @type {Promise<Recommendation>}\n         * @private */\n        this._flowPromise = null;\n        /** @type {boolean} Whether ads are blocked by the browser.\n         * @private */\n        this._adsBlocked = false;\n        /** @type {Object} Cached recommendations from channels other than the main flow channel of 'npr'.\n         * A key-value store where the key is the name of the channel and the value is an array of recommendations.\n         * @private */\n        this._channelRecommendations = {};\n\n        // Ad-blocker detection, used when/if we encounter sponsorship in the flow\n        fetch('http://adswizz.com', { mode: 'no-cors' })\n            .catch(() => {\n                fetch('http://delivery-s3.adswizz.com', { mode: 'no-cors' })\n                    .catch(e => {\n                        Logger.debug('Ads are blocked. ', e);\n                        this._adsBlocked = true;\n                    });\n            });\n    }\n\n    /**\n     * Get a recommendation from NPR.\n     *\n     * Caution: the resulting recommendation may have been returned previously and must be checked\n     * to ensure the same recommendation is not played twice.\n     *\n     * @param {string} [uid='']           Optional; a UID for a specific recommendation to play. In 99% of use cases, this is not needed.\n     * @param {string} [channel='npr']    Optional; a channel to pull the recommendation from; the main flow channel of `npr` is used as the default. In 99% of use cases, this does not need to be changed.\n     * @returns {Promise<Recommendation>}\n     */\n    getRecommendation(uid = '', channel = 'npr') {\n        this._flowPromise = this._advanceFlowRecommendations(channel, uid);\n\n        return this._flowPromise;\n    }\n\n    /**\n     * Return possible recommendations that may come next in the flow. Useful for\n     * pre-caching audio and displaying upcoming recommendations.\n     *\n     * Recommendations returned are not guaranteed to always come next in the flow.\n     *\n     * @experimental\n     * @param {string} [channel='npr']   A channel to pull the next recommendation from\n     * @returns {Promise<Array<Recommendation>>}\n     */\n    getUpcomingFlowRecommendations(channel = 'npr') {\n        if (this._flowRecommendations.length > 0) {\n            return Promise.resolve(this._flowRecommendations);\n        }\n\n        return this._getChannelRecommendations(channel);\n    }\n\n    /**\n     * Makes a new API call to get a list of recommendations. This is NOT intended for regular piece-by-piece consumption;\n     * this function is designed to be used for consumers implementing e.g. the Explore view from the NPR One apps,\n     * where the client displays a list or grid of content, and the user can select a piece to listen to next.\n     * It is hard-coded to use the \"recommended\" channel by default, although other channels can be used also. That said,\n     * you should really never use this with channel \"npr\" (the main flow channel), as this is not how that content is\n     * intended to be consumed.\n     *\n     * @param {string} [channel='recommended']   A non-flow (i.e. non-`npr`) channel to retrieve a list of recommendations from\n     * @returns {Promise<Array<Recommendation>>}\n     */\n    getRecommendationsFromChannel(channel = 'recommended') {\n        const _channel = (!channel || typeof channel !== 'string') ? 'recommended' : channel;\n\n        let prerequisitePromise = Promise.resolve(true);\n        // Send any pending ratings we have first, just in case it impacts the results from the upcoming recommendations call\n        if (this._queuedRatings.length > 0) {\n            prerequisitePromise = this._sendRatings();\n        }\n\n        return prerequisitePromise.then(this._getChannelRecommendations.bind(this, _channel, null))\n            .then((recommendations) => {\n                /* istanbul ignore if: defensive coding; should never really happen */\n                if (!this._channelRecommendations) {\n                    this._channelRecommendations = {};\n                }\n                this._channelRecommendations[_channel] = recommendations;\n                return recommendations;\n            });\n    }\n\n    /**\n     * This synchronous method is intended to be used alongside {@link getRecommendationsFromChannel}.\n     * Once you have a list of recommendations from a channel and an audio story has been selected to play, this method\n     * ensures that the correct ratings (actions) will be sent and the flow of audio will continue appropriately with\n     * the necessary API calls.\n     * If the recommendation with the given UID can be found, it is delivered immediately to be played.\n     * Importantly, this function also returns the selected recommendation on a subsequent call to getRecommendation\n     * (assuming no other ratings are sent in between), so that the consumer can assume that the correct recommendation\n     * will be played next.\n     *\n     * @param {string} channel   The channel used in the original call to `getRecommendationsFromChannel()`\n     * @param {string} uid       The unique ID of the item to queue up for the user\n     * @returns {Recommendation}\n     * @throws {TypeError} If no valid channel or UID is passed in\n     * @throws {Error} If no recommendations for this channel were previously cached, or if the UID was not found in that cached list\n     */\n    queueRecommendationFromChannel(channel, uid) {\n        if (!channel || typeof channel !== 'string') {\n            throw new TypeError('Must pass in a valid channel to queueRecommendationFromChannel()');\n        }\n        if (!uid || typeof uid !== 'string') {\n            throw new TypeError('Must pass in a valid uid to queueRecommendationFromChannel()');\n        }\n        if (!(channel in this._channelRecommendations) ||\n            this._channelRecommendations[channel].length === 0) {\n            throw new Error(`Results from channel \"${channel}\" are not cached. ` +\n                'You must call getRecommendationsFromChannel() first.');\n        }\n\n        for (const recommendation of this._channelRecommendations[channel]) {\n            if (recommendation.attributes.uid === uid) {\n                /* istanbul ignore if: defensive coding; should never really happen */\n                if (!this._flowRecommendations) {\n                    this._flowRecommendations = [recommendation];\n                } else {\n                    this._flowRecommendations = [recommendation].concat(this._flowRecommendations);\n                }\n                return recommendation;\n            }\n        }\n        throw new Error(`Unable to find story with uid ${uid} ` +\n            `in cached list of recommendations from channel \"${channel}\".`);\n    }\n\n    /**\n     * Retrieves a user's history as an array of recommendation objects.\n     *\n     * @returns {Promise<Array<Recommendation>>}\n     */\n    getHistory() {\n        const url = `${NPROneSDK.getServiceUrl('listening')}/history`;\n\n        return FetchUtil.nprApiFetch(url).then(this._createRecommendations.bind(this));\n    }\n\n\n    /**\n     * Resets the current flow for the user. Note that 99% of the time, clients will never have to do this (and it is\n     * generally considered an undesirable user experience), but in a few rare cases it might be needed. The best example\n     * is after calling `setUserStation()` if the current recommendation is of `type === 'stationId'`; in this case,\n     * resetting the flow may be necessary in order to make the user aware that they successfully changed their station.\n     *\n     * @example\n     * let currentRecommendation = nprOneSDK.getRecommendation();\n     * playAudio(currentRecommendation); // given a hypothetical playAudio() function in your app\n     * ...\n     * nprOneSDK.setUserStation(123)\n     *     .then(() => {\n     *         if (currentRecommendation.attributes.type === 'stationId') {\n     *             nprOneSDK.resetFlow()\n     *                 .then(() => {\n     *                     currentRecommendation = nprOneSDK.getRecommendation();\n     *                     playAudio(currentRecommendation);\n     *                 });\n     *         }\n     *     });\n     *\n     * @returns {Promise}\n     */\n    resetFlow() {\n        let prerequisitePromise = Promise.resolve(true);\n\n        if (this._flowRecommendations && this._flowRecommendations.length) {\n            // Send any pending ratings we have first, just in case it impacts the results from the upcoming recommendations call\n            if (this._queuedRatings.length > 0) {\n                prerequisitePromise = this._sendRatings(false);\n            }\n\n            return prerequisitePromise.then(() => {\n                this._flowRecommendations = [];\n                this._flowFetchActive = false;\n                this._flowPromise = null;\n\n                return true;\n            });\n        }\n\n        return prerequisitePromise;\n    }\n\n    /**\n     * Given a valid JSON recommendation object, the flow will advance as\n     * normal from this recommendation. This method has been created for\n     * a special case (Chromecast sharing) and is not intended for use\n     * in a traditional SDK implementation.\n     *\n     * NOTE: this function will overwrite ALL existing flow\n     * recommendations.\n     *\n     * @param {Object} json   Recommendation JSON Object (CDoc+JSON)\n     * @returns {Recommendation}\n     */\n    resumeFlowFromRecommendation(json) {\n        const recommendations = this._createRecommendations(json);\n        this._flowRecommendations = recommendations;\n        return this._flowRecommendations[0];\n    }\n\n    /**\n     * Advances the flow (retrieves new recommendations from the API).\n     *\n     * @param {string} channel\n     * @param {string} uid\n     * @returns {Promise<Array<Recommendation>>}\n     * @throws {Error} If there are no recommendations to return\n     * @private\n     */\n    _advanceFlowRecommendations(channel, uid) {\n        if (this._flowFetchActive) {\n            Logger.debug('A listening service API request is already active, ' +\n                'returning existing promise if one exists.');\n\n            /* istanbul ignore else: defensive coding */\n            if (this._flowPromise) {\n                return this._flowPromise;\n            }\n            /* istanbul ignore next: defensive coding */\n            return Promise.reject(new Error('No recommendations available. Try again later.'));\n        }\n\n        // if given a UID, we check first to see if we already have the recommendation cached\n        if (uid && !!this._flowRecommendations && this._flowRecommendations.length > 0) {\n            let isRecommendationFound = false;\n            this._flowRecommendations.forEach((recommendation, index) => {\n                if (!isRecommendationFound && recommendation.attributes.uid === uid) {\n                    this._flowRecommendations = this._flowRecommendations.slice(index);\n                    isRecommendationFound = true;\n                }\n            });\n            if (isRecommendationFound) {\n                Logger.debug(`Recommendation with UID ${uid} was already queued up. ` +\n                    'Returning the cached version instead of making a new API call.');\n                return Promise.resolve(this._flowRecommendations[0]);\n            }\n        }\n\n        this._flowFetchActive = true;\n        return this._getFlowRecommendations(channel, uid)\n            .then((recommendations) => {\n                this._flowFetchActive = false;\n                if (recommendations.length <= 0) {\n                    Logger.error('API returned no recommendations.');\n                }\n                this._flowRecommendations = this._filterIncomingRecommendations(recommendations);\n                if (!this._flowRecommendations[0]) {\n                    throw new Error('All recommendations exhausted!');\n                }\n                return this._flowRecommendations[0];\n            })\n            .catch(error => {\n                this._flowFetchActive = false;\n                throw error;\n            });\n    }\n\n    /**\n     * Provide any necessary filter to incoming recommendations if needed\n     *\n     * @param {Array<Recommendation>} recommendations\n     * @private\n     */\n    _filterIncomingRecommendations(recommendations) {\n        if (this._adsBlocked) {\n            const unfilteredCount = recommendations.length;\n            const _recommendations = recommendations.filter(rec => !rec.isSponsorship());\n            const filteredCount = unfilteredCount - _recommendations.length;\n            if (filteredCount > 0) {\n                Logger.debug(`Filtered ${filteredCount} ad(s).`);\n            }\n            return _recommendations;\n        }\n\n        return recommendations;\n    }\n\n    /**\n     * Private method to facilitate communication of a rated recommendation.\n     *\n     * @param {Rating} rating\n     * @private\n     */\n    _recordRating(rating) {\n        if (this._queuedRatingsContainsRating(rating)) {\n            return; // no need to take action for the same rating twice\n        }\n\n        Logger.debug(`Queued rating: ${rating}`);\n        this._queuedRatings.push(rating);\n\n        // Only one of these should ever fire, but this is easiest way to do the lookup\n        for (const action of Action.getFlowAdvancingActions()) {\n            if (rating.rating === action) {\n                this.getRecommendation();\n                break;\n            }\n        }\n    }\n\n    /**\n     * Request for recommendations from NPR specifically for the flow as opposed to\n     * other channels which will not change the current flow.\n     *\n     * @param {string} channel\n     * @param {string} uid\n     * @returns {Promise<Array<Recommendation>>}\n     */\n    _getFlowRecommendations(channel, uid) {\n        for (const action of Action.getFlowAdvancingActions()) {\n            if (this._queuedRatingsContainsAction(action)) {\n                return this._sendRatings();\n            }\n        }\n\n        if (!uid) {\n            // Only perform the initial recommendation call if all flow recommendations are exhausted\n            if (this._flowRecommendations.length > 0) {\n                return Promise.resolve(this._flowRecommendations);\n            }\n        }\n\n        return this._getChannelRecommendations(channel, uid);\n    }\n\n    /**\n     * @param {string} channel\n     * @param {string} [uid='']\n     * @returns {Promise<Array<Recommendation>>}\n     * @private\n     */\n    _getChannelRecommendations(channel, uid = '') {\n        const _channel = (!channel || typeof channel !== 'string') ? 'npr' : channel;\n\n        let url = `${NPROneSDK.getServiceUrl('listening')}/recommendations?channel=${_channel}`;\n        url += uid ? `&sharedMediaId=${uid}` : '';\n\n        return FetchUtil.nprApiFetch(url).then(this._createRecommendations.bind(this));\n    }\n\n    /**\n     * Create recommendation objects from collection doc\n     *\n     * @param {Object} json - collection doc\n     * @returns {Array<Recommendation>}\n     * @private\n     */\n    _createRecommendations(json) {\n        const recommendations = createRecommendations(json);\n        const recordRating = this._recordRating.bind(this);\n        recommendations.map(rec => rec.setRatingReceivedCallback(recordRating));\n\n        return recommendations;\n    }\n\n    /**\n     * Send batched ratings\n     *\n     * @param {boolean} [recommendMore=true] - determines if additional recommendations should be returned\n     * @returns {Promise<Array<Recommendation>>}\n     * @private\n     */\n    _sendRatings(recommendMore = true) {\n        /* istanbul ignore if: defensive coding */\n        if (this._queuedRatings.length === 0) {\n            Logger.error('Things have gone drastically wrong, this: ', this);\n            return Promise.reject(new Error('No queued ratings to send.'));\n        }\n\n        let url = NPROneSDK.getServiceUrl('listening');\n        url += `/ratings?recommend=${recommendMore.toString()}`;\n        if (recommendMore) {\n            const latestRating = this._queuedRatings.slice(-1).pop();\n            if (latestRating._actionUrl && latestRating.rating === Action.TAPTHRU) {\n                url = latestRating._actionUrl;\n            } else {\n                url = latestRating._recommendationUrl;\n            }\n        }\n\n        const ratingsToSend = [];\n        this._queuedRatings.forEach(rating => {\n            /* istanbul ignore else: defensive coding */\n            if (!rating._hasSent) {\n                ratingsToSend.push(rating);\n            }\n        });\n\n        const options = {\n            method: 'POST',\n            body: JSON.stringify(ratingsToSend, Rating.privateMemberReplacer),\n        };\n\n        Logger.debug('Sending Ratings: ', ratingsToSend.join(', '));\n\n        return FetchUtil.nprApiFetch(url, options)\n            .then((json) => {\n                // Loop through all queued ratings and mark as sent\n                ratingsToSend.forEach((rating) => {\n                    const _rating = rating;\n                    _rating._hasSent = true;\n                    this._sentRatings.push(_rating);\n                    this._queuedRatings.splice(this._queuedRatings.indexOf(_rating), 1);\n                });\n                return this._createRecommendations(json);\n            });\n    }\n\n    /**\n     * Returns whether currently queued ratings contain a specific rating\n     *\n     * This is not a deep copy check and relies on mediaId & rating string\n     *\n     * @param {Rating} rating\n     * @returns {boolean}\n     * @private\n     */\n    _queuedRatingsContainsRating(rating) {\n        return this._queuedRatings.some(qr => qr.rating === rating.rating && qr.mediaId === rating.mediaId);  // eslint-disable-line\n    }\n\n    /**\n     * Returns whether the currently queued ratings contains a specific action\n     *\n     * @param {string} action\n     * @returns {boolean}\n     * @private\n     */\n    _queuedRatingsContainsAction(action) {\n        return this._queuedRatings.some(qr => qr.rating === action);\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/controller/listening.js\n **/","import Validator from './../util/validator';\n\n/**\n * A thin wrapper around the raw JSON returned from the authorization server to represent a device code/user code pair\n */\nexport default class DeviceCode\n{\n    /**\n     * @param {Object} json    The decoded JSON object that should be used as the basis for this model\n     */\n    constructor(json) {\n        this._raw = json;\n\n        this._expiryDate = null;\n        if (!isNaN(this._raw.expires_in)) {\n            this._expiryDate = new Date(Date.now() + this.ttl);\n        }\n    }\n\n    /**\n     * Ensure that the given device code model is valid\n     *\n     * @throws {TypeError} if device code model is invalid\n     */\n    validate() {\n        Validator.validateDeviceCode(this._raw);\n    }\n\n    /**\n     * Returns whether or not this device code/user code pair has expired.\n     * Note that due to network latency, etc., it's possible that the internally-stored expiry date could be about a\n     * second or so behind, and so this function is not guaranteed to be perfectly accurate.\n     *\n     * @returns {boolean}\n     */\n    isExpired() {\n        return this._expiryDate !== null && (new Date()) >= this._expiryDate;\n    }\n\n    /**\n     * Returns the user code (8-character alphanumeric string)\n     *\n     * @type {string}\n     */\n    get userCode() {\n        return this._raw.user_code;\n    }\n\n    /**\n     * Returns the verification URL (the place where the user should go on their mobile device or laptop to log in)\n     *\n     * @type {string}\n     */\n    get verificationUri() {\n        return this._raw.verification_uri;\n    }\n\n    /**\n     * Returns the TTL (in milliseconds) until this device code/user code pair expires. The SDK will automatically generate\n     * a new key pair upon expiry, so consumers of the SDK will generally not have to use this value directly; however,\n     * you may opt to display on the screen how much time the user has left to log in before a new code is generated.\n     *\n     * @type {number}\n     */\n    get ttl() {\n        return this._raw.expires_in * 1000;\n    }\n\n    /**\n     * Returns the interval (in milliseconds) at which the client (in this case the SDK) should poll the `POST /token`\n     * endpoint (or the OAuth proxy that lies in between). Consumers of the SDK should generally not have to use this\n     * value directly.\n     *\n     * @type {number}\n     */\n    get interval() {\n        return this._raw.interval * 1000;\n    }\n\n    /**\n     * A convenience function to cast this object back to a string, generally only used by the {@link Logger} class.\n     * In this case, we return the raw JSON string representing the entire object.\n     *\n     * @returns {string}\n     */\n    toString() {\n        return JSON.stringify(this._raw);\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/model/device-code.js\n **/","import CollectionDoc from './collection-doc';\n\n/**\n * Container class for all metadata pertaining to an organization (member station) from the NPR One API\n *\n * @extends {CollectionDoc}\n */\nexport default class Station extends CollectionDoc {\n    /**\n     * @param {CollectionDocJSON} json    The decoded JSON object that should be used as the basis for this model\n     */\n    constructor(json) {\n        super(json);\n        this._validate();\n    }\n\n    /**\n     * Returns the unique ID that represents this station across NPR's various APIs. The ID is an integer between 1 and\n     * 9999, but it will always be returned in string format.\n     *\n     * @type {string}\n     */\n    get id() {\n        return this._raw.attributes.org_id;\n    }\n\n    /**\n     * Returns the display name that the station would prefer to use. Please use this anytime you want to display a\n     * given station's name, rather than attempting to find the appropriate field inside of {@link Station.attributes}\n     * yourself; branding is a sensitive issue for stations and we should all respect how they wish to be identified.\n     *\n     * @type {string}\n     */\n    get displayName() {\n        return this._raw.attributes.name ? this._raw.attributes.name : this._raw.attributes.call;\n    }\n\n    /**\n     * Returns the logo for this station, if one can be found. If it exists, the NPR One-specific logo will take\n     * precedence, but it will fall back to the regular station logo if not present. If no logo can be found at all,\n     * this will return `null`.\n     *\n     * @type {null|string}\n     */\n    get logo() {\n        if (this._raw.attributes.apps && this._raw.attributes.apps.npr_one &&\n            this._raw.attributes.apps.npr_one.logo) {\n            return this._raw.attributes.apps.npr_one.logo;\n        }\n        if (this._raw.links.image) {\n            for (const link of this._raw.links.image) {\n                if (link.type_id === '18' || link.type_id === '23') {\n                    return link.href;\n                }\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Returns the tagline for this station. This should be used as supplemental metadata for a station; it should never\n     * be used as the sole identifying information. Note that while the majority of the stations in our system have\n     * taglines, it is not guaranteed that each station has one.\n     *\n     * @type {string}\n     */\n    get tagline() {\n        return this._raw.attributes.tagline || '';\n    }\n\n    /**\n     * Returns the call sign, brand (AM or FM), and frequency together as one string, e.g. `'WAMU FM 88.5'` or\n     * `'KCFR FM 90.1'` or `'KWSU AM 1250'`. Again, this should be treated as supplemental metadata for a station and\n     * not the sole identifying information; where possible, stations prefer to be identified primarily by their\n     * {@link displayName} and {@link logo}. However, some local stations are members of networks such as Colorado Public Radio\n     * and therefore use the same display name and logo; in those cases, the call sign + band + frequency combination is\n     * the main way to disambiguate between multiple stations in the same network. This value is guaranteed to be unique.\n     *\n     * @type {null|string}\n     */\n    get callSignAndFrequency() {\n        let callSignAndFrequency = '';\n        if (this._raw.attributes.call) {\n            callSignAndFrequency += this._raw.attributes.call;\n        }\n        if (this._raw.attributes.band) {\n            callSignAndFrequency += ` ${this._raw.attributes.band}`;\n        }\n        if (this._raw.attributes.frequency) {\n            callSignAndFrequency += ` ${this._raw.attributes.frequency}`;\n        }\n        return callSignAndFrequency.trim() || null;\n    }\n\n    /**\n     * Returns the location of the station, which always consists of a city and (abbreviated) state, e.g. `'Austin, TX'`\n     * or `'Rochester, NY'`. Similarly to {@link callSignAndFrequency}, this is most useful for disambiguating between\n     * multiple local stations in a bigger network such as Colorado Public Radio, which use the same {@link displayName}\n     * and {@link logo}. Note that this value isn't guaranteed to be unique; some cities (e.g. Boston) have multiple\n     * NPR stations.\n     *\n     * @type {string}\n     */\n    get location() {\n        return `${this._raw.attributes.market_city}, ${this._raw.attributes.market_state}`;\n    }\n\n    /**\n     * Returns the URL to the station's website, if available.\n     *\n     * @type {null|string}\n     */\n    get homepageUrl() {\n        if (this._raw.links.web) {\n            for (const link of this._raw.links.web) {\n                if (link.type_id === '1') {\n                    return link.href;\n                }\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Returns the URL to the station's online pledge page, if available.\n     *\n     * @type {null|string}\n     */\n    get donationUrl() {\n        if (this._raw.attributes.apps && this._raw.attributes.apps.npr_one &&\n            this._raw.attributes.apps.npr_one.donation_url) {\n            return this._raw.attributes.apps.npr_one.donation_url;\n        }\n        if (this._raw.links.web) {\n            for (const link of this._raw.links.web) {\n                if (link.type_id === '4' || link.type_id === '27') {\n                    return link.href;\n                }\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Returns the raw attributes that represent this station. Please use this with caution; the public accessor methods\n     * in this class should be sufficient for most use cases, and consumers should rarely need to use this additional\n     * metadata. These attributes will also be changing in version 3 of the Station Finder Service, so we are\n     * discouraging clients from writing code against these.\n     *\n     * @type {StationAttributes}\n     */\n    get attributes() {\n        return this._raw.attributes;\n    }\n\n    /**\n     * A convenience function to cast this object back to a string, generally only used by the {@link Logger} class.\n     * In this case, we return the station's display name.\n     *\n     * @returns {string}\n     */\n    toString() {\n        return this.displayName;\n    }\n\n    /**\n     * @typedef {Object} StationAttributes\n     * @property {StationAppsList} apps An associative array of application-specific metadata for this station\n     * @property {string} guid The system's internal unique identifier for a station, not typically used by other APIs or consumers\n     * @property {string} org_id The system's unique ID for this station, used across NPR One Microservices and NPR's other APIs\n     * @property {string} name The display name for the station. In most cases, this will be the same as call letters combined with band. When returning networks, it will return the network name (e.g. Minnesota Public Radio).\n     * @property {string} title An alternative display name for the station. Consumers are discouraged from using this and encouraged to use name instead.\n     * @property {string} abbreviation An abbreviated name for the station. Consumers are discouraged from using this and encouraged to use name instead.\n     * @property {string} call The three-to-four-letter identifying code for this station. Please use this with caution; most stations prefer to be identified by their name in client applications instead of call.\n     * @property {string} frequency Where on the radio dial the station can be heard. If the band is AM, the frequency will be between 540 and 1600. If the band is FM, the frequency will be between 87.8 and 108.0.\n     * @property {string} band The subsection of the radio spectrum -- 'AM' or 'FM' -- where this station can be heard\n     * @property {string} tagline A short text-logo for the station\n     * @property {Array<string>} address The address of the station's main office\n     * @property {string} market_city The city that the station is most closely associated with. This may or may not be the city the station is licensed in and it may or may not be the city that the station or the station's antenna is located in.\n     * @property {string} market_state The state that the station is most closely associated with. This may or may not be the state the station is licensed in and it may or may not be the state that the station or the station's antenna is located in.\n     * @property {string} format The format of the programming on this station\n     * @property {boolean} music_only Whether or not this station only plays music\n     * @property {string} status The status of the station within NPR's system, not typically used by consumers\n     * @property {string} status_name The semantic name corresponding to the status ID\n     * @property {string} email The station's primary contact e-mail address\n     * @property {string} area_code The area code for the station's main office\n     * @property {string} phone The phone number for the station's main office\n     * @property {string} phone_extension The phone extension for the station's main office\n     * @property {string} fax The fax number for the station's main office\n     * @property {StationNetwork} network The parent organization, if this station is part of a network\n     * @property {boolean} npr_one Whether or not this organization is considered an NPR One station\n     */\n    /**\n     * @typedef {Object} StationAppsList\n     * @property {StationNprOneData} npr_one A list of metadata designed for use by NPR One clients\n     */\n    /**\n     * @typedef {Object} StationNprOneData\n     * @property {string} name The name to display for this station within NPR One clients\n     * @property {string} logo The URL of an image associated with the station\n     * @property {string} donation_url The URL to a website where users may make a donation to support the station\n     * @property {string} donation_audio The audio to play inviting users to make a donation\n     * @property {string} thankyou_audio The audio to play when users have successfully made an in-app donation\n     * @property {Array<string>} sonic_id_audio The audio to play when users start a listening session, not typically used directly by consumers\n     * @property {Array<string>} hello_id_audio The audio to play when users start a listening session, not typically used directly by consumers\n     */\n    /**\n     * @typedef {Object} StationNetwork\n     * @property {string} org_id The system's unique ID for the parent organization (network), used across NPR One Microservices and NPR's other APIs\n     * @property {string} name The display name for the parent organization (network)\n     */\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/model/station.js\n **/","import CollectionDoc from './collection-doc';\n\n/**\n * Container class for all metadata pertaining to a user object from the NPR One API\n *\n * @extends {CollectionDoc}\n */\nexport default class User extends CollectionDoc\n{\n    /**\n     * @param {CollectionDocJSON} json    The decoded JSON object that should be used as the basis for this model\n     */\n    constructor(json) {\n        super(json);\n        /** @type {Object}\n         * @private */\n        this._raw = json;\n        /** @type {UserAttributes} */\n        this.attributes = {};\n        this._hydrate();\n    }\n\n    /**\n     * Hydrate the internal member variables.\n     *\n     * @private\n     */\n    _hydrate() {\n        this._validate();\n        this.attributes = this._raw.attributes;\n    }\n\n    /**\n     * Whether this user is a temporary user or not\n     *\n     * @returns {boolean}\n     */\n    isTemporary() {\n        return parseInt(this.attributes.id, 10) >= 1000000000;\n    }\n\n    /**\n     * Returns the user's cohort. In most cases, SDK consumers will never need to use this.\n     *\n     * @returns {UserCohort}\n     */\n    getCohort() {\n        return this.attributes.cohort;\n    }\n\n    /**\n     * Returns the list of organizations this user is affiliated with. In most cases, you only want a single\n     * organization, in which case {@link User#getPrimaryOrganization} should be used.\n     *\n     * @returns {Array<UserOrganization>}\n     */\n    getOrganizations() {\n        return this.attributes.organizations || [];\n    }\n\n    /**\n     * Returns the primary, non-NPR organization that this user is affiliated with, or null if no such organization\n     * exists.\n     *\n     * @returns {null|UserOrganization}\n     */\n    getPrimaryOrganization() {\n        const orgs = this.getOrganizations();\n        return orgs[0] && orgs[0].id !== '1' ? orgs[0] : null;\n    }\n\n    /**\n     * Returns the programs, shows, and podcasts that this user has positively interacted with.\n     *\n     * @returns {Array<UserAffiliation>}\n     */\n    getAffiliations() {\n        return this.attributes.affiliations;\n    }\n\n    /**\n     * A convenience function to cast this object back to a string, generally only used by the {@link Logger} class.\n     * In this case, we return the user's ID.\n     *\n     * @returns {string}\n     */\n    toString() {\n        return this.attributes.id;\n    }\n\n    /**\n     * @typedef {Object} UserAttributes\n     * @property {string} id Some unique identifier for the user\n     * @property {string} email The user's email address\n     * @property {string} firstName The user's first name\n     * @property {string} lastName The user's last name\n     * @property {UserCohort} cohort The user's cohort (an experimental grouping for User Experience A/B Testing)\n     * @property {Array<UserOrganization>} organizations User's chosen NPR Member Station(s)\n     * @property {Array<UserAffiliation>} affiliations Programs, shows, and podcasts that the user has positively interacted with\n     */\n    /**\n     * @typedef {Object} UserCohort\n     * @property {string} id A short ID for this cohort\n     * @property {string} name A text string identifying the cohort, useful for metrics\n     * @property {string} directory For internal use only; represents the current configuration file being used by the Listening Service\n     */\n    /**\n     * @typedef {Object} UserOrganization\n     * @property {string} id Some unique identifier for the organization\n     * @property {string} displayName A short displayable text field for the end user, strictly text\n     * @property {string} call Station call letters\n     * @property {string} city A short description of the station's main market city\n     * @property {string} [logo] Station logo image URL\n     * @property {string} [donationUrl] The URL to a website where users may make a donation to support the station\n     */\n    /**\n     * @typedef {Object} UserAffiliation\n     * @property {number} id A unique identifier for the aggregation (program)\n     * @property {string} [title] The display name of the aggregation (program)\n     * @property {string} href A link that can be followed to get content from this aggregation (program)\n     * @property {boolean} following Whether or not the user is following the aggregation. When changing affiliation status, the client is expected to toggle this value and then send the entire object back.\n     * @property {number} [rating] The user's average rating for this affiliation on a scale of 0-1. Absent if user never listened to the aggregation.\n     * @property {number} [daysSinceLastListen] The number of days since a user last listened to a story from this aggregation. Absent if user never listened to the aggregation.\n     */\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/model/user.js\n **/","import Validator from './validator';\nimport Recommendation from './../model/recommendation';\nimport Logger from './../util/logger';\n\n\n/**\n * Creates recommendation objects from collection doc ensuring that necessary\n * properties are present\n *\n * @param {CollectionDocJSON} collectionDoc\n * @returns {Array<Recommendation>}\n * @throws {TypeError} if the collectionDoc passed in is not valid\n */\nexport default function createRecommendations(collectionDoc) {\n    Validator.validateCollectionDoc(collectionDoc);\n\n    const recommendations = [];\n    collectionDoc.items.forEach((item) => {\n        try {\n            recommendations.push(new Recommendation(item));\n        } catch (e) {\n            Logger.warn('Recommendation is invalid and has been excluded.', e);\n        }\n    });\n\n    return recommendations;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/recommendation-creator.js\n **/","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _extendableBuiltin(cls) {\n  function ExtendableBuiltin() {\n    cls.apply(this, arguments);\n  }\n\n  ExtendableBuiltin.prototype = Object.create(cls.prototype, {\n    constructor: {\n      value: cls,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n\n  if (Object.setPrototypeOf) {\n    Object.setPrototypeOf(ExtendableBuiltin, cls);\n  } else {\n    ExtendableBuiltin.__proto__ = cls;\n  }\n\n  return ExtendableBuiltin;\n}\n\nvar ExtendableError = function (_extendableBuiltin2) {\n  _inherits(ExtendableError, _extendableBuiltin2);\n\n  function ExtendableError() {\n    var message = arguments.length <= 0 || arguments[0] === undefined ? '' : arguments[0];\n\n    _classCallCheck(this, ExtendableError);\n\n    // extending Error is weird and does not propagate `message`\n\n    var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(ExtendableError).call(this, message));\n\n    Object.defineProperty(_this, 'message', {\n      configurable: true,\n      enumerable: false,\n      value: message,\n      writable: true\n    });\n\n    Object.defineProperty(_this, 'name', {\n      configurable: true,\n      enumerable: false,\n      value: _this.constructor.name,\n      writable: true\n    });\n\n    if (Error.hasOwnProperty('captureStackTrace')) {\n      Error.captureStackTrace(_this, _this.constructor);\n      return _possibleConstructorReturn(_this);\n    }\n\n    Object.defineProperty(_this, 'stack', {\n      configurable: true,\n      enumerable: false,\n      value: new Error(message).stack,\n      writable: true\n    });\n    return _this;\n  }\n\n  return ExtendableError;\n}(_extendableBuiltin(Error));\n\nexports.default = ExtendableError;\nmodule.exports = exports['default'];\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/es6-error/lib/index.js\n ** module id = 21\n ** module chunks = 0 1\n **/","/*!\r\n * js-logger - http://github.com/jonnyreeves/js-logger\r\n * Jonny Reeves, http://jonnyreeves.co.uk/\r\n * js-logger may be freely distributed under the MIT license.\r\n */\r\n(function (global) {\r\n\t\"use strict\";\r\n\r\n\t// Top level module for the global, static logger instance.\r\n\tvar Logger = { };\r\n\r\n\t// For those that are at home that are keeping score.\r\n\tLogger.VERSION = \"1.2.0\";\r\n\r\n\t// Function which handles all incoming log messages.\r\n\tvar logHandler;\r\n\r\n\t// Map of ContextualLogger instances by name; used by Logger.get() to return the same named instance.\r\n\tvar contextualLoggersByNameMap = {};\r\n\r\n\t// Polyfill for ES5's Function.bind.\r\n\tvar bind = function(scope, func) {\r\n\t\treturn function() {\r\n\t\t\treturn func.apply(scope, arguments);\r\n\t\t};\r\n\t};\r\n\r\n\t// Super exciting object merger-matron 9000 adding another 100 bytes to your download.\r\n\tvar merge = function () {\r\n\t\tvar args = arguments, target = args[0], key, i;\r\n\t\tfor (i = 1; i < args.length; i++) {\r\n\t\t\tfor (key in args[i]) {\r\n\t\t\t\tif (!(key in target) && args[i].hasOwnProperty(key)) {\r\n\t\t\t\t\ttarget[key] = args[i][key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn target;\r\n\t};\r\n\r\n\t// Helper to define a logging level object; helps with optimisation.\r\n\tvar defineLogLevel = function(value, name) {\r\n\t\treturn { value: value, name: name };\r\n\t};\r\n\r\n\t// Predefined logging levels.\r\n\tLogger.DEBUG = defineLogLevel(1, 'DEBUG');\r\n\tLogger.INFO = defineLogLevel(2, 'INFO');\r\n\tLogger.TIME = defineLogLevel(3, 'TIME');\r\n\tLogger.WARN = defineLogLevel(4, 'WARN');\r\n\tLogger.ERROR = defineLogLevel(8, 'ERROR');\r\n\tLogger.OFF = defineLogLevel(99, 'OFF');\r\n\r\n\t// Inner class which performs the bulk of the work; ContextualLogger instances can be configured independently\r\n\t// of each other.\r\n\tvar ContextualLogger = function(defaultContext) {\r\n\t\tthis.context = defaultContext;\r\n\t\tthis.setLevel(defaultContext.filterLevel);\r\n\t\tthis.log = this.info;  // Convenience alias.\r\n\t};\r\n\r\n\tContextualLogger.prototype = {\r\n\t\t// Changes the current logging level for the logging instance.\r\n\t\tsetLevel: function (newLevel) {\r\n\t\t\t// Ensure the supplied Level object looks valid.\r\n\t\t\tif (newLevel && \"value\" in newLevel) {\r\n\t\t\t\tthis.context.filterLevel = newLevel;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// Is the logger configured to output messages at the supplied level?\r\n\t\tenabledFor: function (lvl) {\r\n\t\t\tvar filterLevel = this.context.filterLevel;\r\n\t\t\treturn lvl.value >= filterLevel.value;\r\n\t\t},\r\n\r\n\t\tdebug: function () {\r\n\t\t\tthis.invoke(Logger.DEBUG, arguments);\r\n\t\t},\r\n\r\n\t\tinfo: function () {\r\n\t\t\tthis.invoke(Logger.INFO, arguments);\r\n\t\t},\r\n\r\n\t\twarn: function () {\r\n\t\t\tthis.invoke(Logger.WARN, arguments);\r\n\t\t},\r\n\r\n\t\terror: function () {\r\n\t\t\tthis.invoke(Logger.ERROR, arguments);\r\n\t\t},\r\n\r\n\t\ttime: function (label) {\r\n\t\t\tif (typeof label === 'string' && label.length > 0) {\r\n\t\t\t\tthis.invoke(Logger.TIME, [ label, 'start' ]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\ttimeEnd: function (label) {\r\n\t\t\tif (typeof label === 'string' && label.length > 0) {\r\n\t\t\t\tthis.invoke(Logger.TIME, [ label, 'end' ]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// Invokes the logger callback if it's not being filtered.\r\n\t\tinvoke: function (level, msgArgs) {\r\n\t\t\tif (logHandler && this.enabledFor(level)) {\r\n\t\t\t\tlogHandler(msgArgs, merge({ level: level }, this.context));\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// Protected instance which all calls to the to level `Logger` module will be routed through.\r\n\tvar globalLogger = new ContextualLogger({ filterLevel: Logger.OFF });\r\n\r\n\t// Configure the global Logger instance.\r\n\t(function() {\r\n\t\t// Shortcut for optimisers.\r\n\t\tvar L = Logger;\r\n\r\n\t\tL.enabledFor = bind(globalLogger, globalLogger.enabledFor);\r\n\t\tL.debug = bind(globalLogger, globalLogger.debug);\r\n\t\tL.time = bind(globalLogger, globalLogger.time);\r\n\t\tL.timeEnd = bind(globalLogger, globalLogger.timeEnd);\r\n\t\tL.info = bind(globalLogger, globalLogger.info);\r\n\t\tL.warn = bind(globalLogger, globalLogger.warn);\r\n\t\tL.error = bind(globalLogger, globalLogger.error);\r\n\r\n\t\t// Don't forget the convenience alias!\r\n\t\tL.log = L.info;\r\n\t}());\r\n\r\n\t// Set the global logging handler.  The supplied function should expect two arguments, the first being an arguments\r\n\t// object with the supplied log messages and the second being a context object which contains a hash of stateful\r\n\t// parameters which the logging function can consume.\r\n\tLogger.setHandler = function (func) {\r\n\t\tlogHandler = func;\r\n\t};\r\n\r\n\t// Sets the global logging filter level which applies to *all* previously registered, and future Logger instances.\r\n\t// (note that named loggers (retrieved via `Logger.get`) can be configured independently if required).\r\n\tLogger.setLevel = function(level) {\r\n\t\t// Set the globalLogger's level.\r\n\t\tglobalLogger.setLevel(level);\r\n\r\n\t\t// Apply this level to all registered contextual loggers.\r\n\t\tfor (var key in contextualLoggersByNameMap) {\r\n\t\t\tif (contextualLoggersByNameMap.hasOwnProperty(key)) {\r\n\t\t\t\tcontextualLoggersByNameMap[key].setLevel(level);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// Retrieve a ContextualLogger instance.  Note that named loggers automatically inherit the global logger's level,\r\n\t// default context and log handler.\r\n\tLogger.get = function (name) {\r\n\t\t// All logger instances are cached so they can be configured ahead of use.\r\n\t\treturn contextualLoggersByNameMap[name] ||\r\n\t\t\t(contextualLoggersByNameMap[name] = new ContextualLogger(merge({ name: name }, globalLogger.context)));\r\n\t};\r\n\r\n\t// Configure and example a Default implementation which writes to the `window.console` (if present).  The\r\n\t// `options` hash can be used to configure the default logLevel and provide a custom message formatter.\r\n\tLogger.useDefaults = function(options) {\r\n\t\toptions = options || {};\r\n\r\n\t\toptions.formatter = options.formatter || function defaultMessageFormatter(messages, context) {\r\n\t\t\t// Prepend the logger's name to the log message for easy identification.\r\n\t\t\tif (context.name) {\r\n\t\t\t\tmessages.unshift(\"[\" + context.name + \"]\");\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Check for the presence of a logger.\r\n\t\tif (typeof console === \"undefined\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Map of timestamps by timer labels used to track `#time` and `#timeEnd()` invocations in environments\r\n\t\t// that don't offer a native console method.\r\n\t\tvar timerStartTimeByLabelMap = {};\r\n\r\n\t\t// Support for IE8+ (and other, slightly more sane environments)\r\n\t\tvar invokeConsoleMethod = function (hdlr, messages) {\r\n\t\t\tFunction.prototype.apply.call(hdlr, console, messages);\r\n\t\t};\r\n\r\n\t\tLogger.setLevel(options.defaultLevel || Logger.DEBUG);\r\n\t\tLogger.setHandler(function(messages, context) {\r\n\t\t\t// Convert arguments object to Array.\r\n\t\t\tmessages = Array.prototype.slice.call(messages);\r\n\r\n\t\t\tvar hdlr = console.log;\r\n\t\t\tvar timerLabel;\r\n\r\n\t\t\tif (context.level === Logger.TIME) {\r\n\t\t\t\ttimerLabel = (context.name ? '[' + context.name + '] ' : '') + messages[0];\r\n\r\n\t\t\t\tif (messages[1] === 'start') {\r\n\t\t\t\t\tif (console.time) {\r\n\t\t\t\t\t\tconsole.time(timerLabel);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttimerStartTimeByLabelMap[timerLabel] = new Date().getTime();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (console.timeEnd) {\r\n\t\t\t\t\t\tconsole.timeEnd(timerLabel);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tinvokeConsoleMethod(hdlr, [ timerLabel + ': ' +\r\n\t\t\t\t\t\t\t(new Date().getTime() - timerStartTimeByLabelMap[timerLabel]) + 'ms' ]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Delegate through to custom warn/error loggers if present on the console.\r\n\t\t\t\tif (context.level === Logger.WARN && console.warn) {\r\n\t\t\t\t\thdlr = console.warn;\r\n\t\t\t\t} else if (context.level === Logger.ERROR && console.error) {\r\n\t\t\t\t\thdlr = console.error;\r\n\t\t\t\t} else if (context.level === Logger.INFO && console.info) {\r\n\t\t\t\t\thdlr = console.info;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toptions.formatter(messages, context);\r\n\t\t\t\tinvokeConsoleMethod(hdlr, messages);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\t// Export to popular environments boilerplate.\r\n\tif (typeof define === 'function' && define.amd) {\r\n\t\tdefine(Logger);\r\n\t}\r\n\telse if (typeof module !== 'undefined' && module.exports) {\r\n\t\tmodule.exports = Logger;\r\n\t}\r\n\telse {\r\n\t\tLogger._prevLogger = global.Logger;\r\n\r\n\t\tLogger.noConflict = function () {\r\n\t\t\tglobal.Logger = Logger._prevLogger;\r\n\t\t\treturn Logger;\r\n\t\t};\r\n\r\n\t\tglobal.Logger = Logger;\r\n\t}\r\n}(this));\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/js-logger/src/logger.js\n ** module id = 22\n ** module chunks = 0 1\n **/","'use strict';\n\nvar has = Object.prototype.hasOwnProperty;\n\n/**\n * Simple query string parser.\n *\n * @param {String} query The query string that needs to be parsed.\n * @returns {Object}\n * @api public\n */\nfunction querystring(query) {\n  var parser = /([^=?&]+)=([^&]*)/g\n    , result = {}\n    , part;\n\n  //\n  // Little nifty parsing hack, leverage the fact that RegExp.exec increments\n  // the lastIndex property so we can continue executing this loop until we've\n  // parsed all results.\n  //\n  for (;\n    part = parser.exec(query);\n    result[decodeURIComponent(part[1])] = decodeURIComponent(part[2])\n  );\n\n  return result;\n}\n\n/**\n * Transform a query string to an object.\n *\n * @param {Object} obj Object that should be transformed.\n * @param {String} prefix Optional prefix.\n * @returns {String}\n * @api public\n */\nfunction querystringify(obj, prefix) {\n  prefix = prefix || '';\n\n  var pairs = [];\n\n  //\n  // Optionally prefix with a '?' if needed\n  //\n  if ('string' !== typeof prefix) prefix = '?';\n\n  for (var key in obj) {\n    if (has.call(obj, key)) {\n      pairs.push(encodeURIComponent(key) +'='+ encodeURIComponent(obj[key]));\n    }\n  }\n\n  return pairs.length ? prefix + pairs.join('&') : '';\n}\n\n//\n// Expose the module.\n//\nexports.stringify = querystringify;\nexports.parse = querystring;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/querystringify/index.js\n ** module id = 23\n ** module chunks = 0 1\n **/","'use strict';\n\n/**\n * Check if we're required to add a port number.\n *\n * @see https://url.spec.whatwg.org/#default-port\n * @param {Number|String} port Port number we need to check\n * @param {String} protocol Protocol we need to check against.\n * @returns {Boolean} Is it a default port for the given protocol\n * @api private\n */\nmodule.exports = function required(port, protocol) {\n  protocol = protocol.split(':')[0];\n  port = +port;\n\n  if (!port) return false;\n\n  switch (protocol) {\n    case 'http':\n    case 'ws':\n    return port !== 80;\n\n    case 'https':\n    case 'wss':\n    return port !== 443;\n\n    case 'ftp':\n    return port !== 21;\n\n    case 'gopher':\n    return port !== 70;\n\n    case 'file':\n    return false;\n  }\n\n  return port !== 0;\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/requires-port/index.js\n ** module id = 24\n ** module chunks = 0 1\n **/","'use strict';\n\n/**\n * These properties should not be copied or inherited from. This is only needed\n * for all non blob URL's as the a blob URL does not include a hash, only the\n * origin.\n *\n * @type {Object}\n * @private\n */\nvar ignore = { hash: 1, query: 1 }\n  , URL;\n\n/**\n * The location object differs when your code is loaded through a normal page,\n * Worker or through a worker using a blob. And with the blobble begins the\n * trouble as the location object will contain the URL of the blob, not the\n * location of the page where our code is loaded in. The actual origin is\n * encoded in the `pathname` so we can thankfully generate a good \"default\"\n * location from it so we can generate proper relative URL's again.\n *\n * @param {Object} loc Optional default location object.\n * @returns {Object} lolcation object.\n * @api public\n */\nmodule.exports = function lolcation(loc) {\n  loc = loc || global.location || {};\n  URL = URL || require('./');\n\n  var finaldestination = {}\n    , type = typeof loc\n    , key;\n\n  if ('blob:' === loc.protocol) {\n    finaldestination = new URL(unescape(loc.pathname), {});\n  } else if ('string' === type) {\n    finaldestination = new URL(loc, {});\n    for (key in ignore) delete finaldestination[key];\n  } else if ('object' === type) for (key in loc) {\n    if (key in ignore) continue;\n    finaldestination[key] = loc[key];\n  }\n\n  return finaldestination;\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/url-parse/lolcation.js\n ** module id = 25\n ** module chunks = 0 1\n **/","(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var list = this.map[name]\n    if (!list) {\n      list = []\n      this.map[name] = list\n    }\n    list.push(value)\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    var values = this.map[normalizeName(name)]\n    return values ? values[0] : null\n  }\n\n  Headers.prototype.getAll = function(name) {\n    return this.map[normalizeName(name)] || []\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = [normalizeValue(value)]\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    Object.getOwnPropertyNames(this.map).forEach(function(name) {\n      this.map[name].forEach(function(value) {\n        callback.call(thisArg, value, name, this)\n      }, this)\n    }, this)\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    reader.readAsArrayBuffer(blob)\n    return fileReaderReady(reader)\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    reader.readAsText(blob)\n    return fileReaderReady(reader)\n  }\n\n  var support = {\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob();\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (!body) {\n        this._bodyText = ''\n      } else if (support.arrayBuffer && ArrayBuffer.prototype.isPrototypeOf(body)) {\n        // Only support ArrayBuffers for POST method.\n        // Receiving ArrayBuffers happens via Blobs, instead.\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        return this.blob().then(readBlobAsArrayBuffer)\n      }\n\n      this.text = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return readBlobAsText(this._bodyBlob)\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as text')\n        } else {\n          return Promise.resolve(this._bodyText)\n        }\n      }\n    } else {\n      this.text = function() {\n        var rejected = consumed(this)\n        return rejected ? rejected : Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n    if (Request.prototype.isPrototypeOf(input)) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    } else {\n      this.url = input\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this)\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function headers(xhr) {\n    var head = new Headers()\n    var pairs = xhr.getAllResponseHeaders().trim().split('\\n')\n    pairs.forEach(function(header) {\n      var split = header.trim().split(':')\n      var key = split.shift().trim()\n      var value = split.join(':').trim()\n      head.append(key, value)\n    })\n    return head\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = options.status\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = options.statusText\n    this.headers = options.headers instanceof Headers ? options.headers : new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers;\n  self.Request = Request;\n  self.Response = Response;\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request\n      if (Request.prototype.isPrototypeOf(input) && !init) {\n        request = input\n      } else {\n        request = new Request(input, init)\n      }\n\n      var xhr = new XMLHttpRequest()\n\n      function responseURL() {\n        if ('responseURL' in xhr) {\n          return xhr.responseURL\n        }\n\n        // Avoid security warnings on getResponseHeader when not allowed by CORS\n        if (/^X-Request-URL:/m.test(xhr.getAllResponseHeaders())) {\n          return xhr.getResponseHeader('X-Request-URL')\n        }\n\n        return;\n      }\n\n      xhr.onload = function() {\n        var status = (xhr.status === 1223) ? 204 : xhr.status\n        if (status < 100 || status > 599) {\n          reject(new TypeError('Network request failed'))\n          return\n        }\n        var options = {\n          status: status,\n          statusText: xhr.statusText,\n          headers: headers(xhr),\n          url: responseURL()\n        }\n        var body = 'response' in xhr ? xhr.response : xhr.responseText;\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/whatwg-fetch/fetch.js\n ** module id = 26\n ** module chunks = 0 1\n **/"],"sourceRoot":""}